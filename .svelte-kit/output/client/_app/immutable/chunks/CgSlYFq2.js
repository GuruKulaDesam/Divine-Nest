import"./Bzak7iHL.js";import"./DW9ov6mQ.js";import{o as Ft}from"./BKdxYII_.js";import{p as Ut,m as O,d as k,t as G,j as A,a as b,b as jt,h as i,e as c,g as t,i as R,s as l,r as n,aw as de,M as Nt,aB as bt,aC as Rt,aD as Y,c as Fe,f as ve,aF as me}from"./DFw88cu1.js";import{i as F}from"./CtMEnX0n.js";import{e as V,i as W}from"./BTPm-04w.js";import{a as Ue,c as Bt,r as te,b as gt}from"./-87vorbC.js";import{b as X}from"./DDIA5LkU.js";import{i as Lt}from"./BNOMXApT.js";import{t as he,a as ke,g as J}from"./DMmwAmNg.js";var Ht=k('<div class="text-white/50 svelte-15k7b7r"> </div>'),qt=k('<div class="svelte-15k7b7r"></div>'),Yt=k('<div class="py-1 px-1 rounded hover:bg-white/10 cursor-pointer text-white/80 hover:text-white transition-colors svelte-15k7b7r" role="button" tabindex="0"></div>'),Vt=k('<div class="flex items-center gap-2 p-2 rounded-lg bg-white/5 border border-white/10 svelte-15k7b7r"><div class="w-2 h-2 rounded-full svelte-15k7b7r"></div> <div class="truncate text-white/80 svelte-15k7b7r"> <span class="text-xs text-white/60 svelte-15k7b7r"> </span></div></div>'),Wt=k('<div class="text-xs font-medium text-white/70 svelte-15k7b7r" style="color: var(--tw-color-slate-600);"><span class="inline-block px-2 py-1 rounded svelte-15k7b7r" style="background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(0,0,0,0));"> </span></div>'),Jt=k('<div class="svelte-15k7b7r"></div>'),Kt=k('<div class="cursor-pointer event-indicator svelte-15k7b7r" role="button" tabindex="0"><span class="inline-block rounded-full px-2 py-0.5 text-xs text-white font-medium shadow-sm svelte-15k7b7r"> </span></div>'),Qt=k('<div class="text-xs text-white/70 font-medium svelte-15k7b7r"> </div>'),Xt=k('<div class="p-3 min-h-[100px] day-cell svelte-15k7b7r"><div class="flex items-start justify-between svelte-15k7b7r"><div class="font-semibold text-lg calendar-header svelte-15k7b7r"></div> <button class="btn btn-ghost btn-xs text-blue-400 hover:text-blue-300 hover:bg-white/10 rounded-full svelte-15k7b7r" aria-label="Add event"><span class="text-green-400 svelte-15k7b7r">+</span></button></div> <div class="mt-2 space-y-1 svelte-15k7b7r"><!> <!></div></div>'),Zt=k('<option class="svelte-15k7b7r"> </option>'),ea=k('<div class="fixed inset-0 flex items-center justify-center bg-black/40 z-50 svelte-15k7b7r"><div class="bg-base-100 rounded-lg p-6 w-[640px] svelte-15k7b7r"><h3 class="text-lg font-semibold mb-3 svelte-15k7b7r"> </h3> <div class="grid grid-cols-2 gap-3 svelte-15k7b7r"><label class="text-sm svelte-15k7b7r">Title <input class="input svelte-15k7b7r" placeholder="Title"/></label> <label class="text-sm svelte-15k7b7r">Date <input type="date" class="input svelte-15k7b7r"/></label> <label class="text-sm svelte-15k7b7r">Time <input type="time" class="input svelte-15k7b7r"/></label> <label class="text-sm svelte-15k7b7r">Color <input type="color" class="input p-0 svelte-15k7b7r"/></label> <label class="text-sm svelte-15k7b7r">Category <select class="input svelte-15k7b7r"></select></label> <label class="text-sm svelte-15k7b7r">Recurrence <select class="input svelte-15k7b7r"><option class="svelte-15k7b7r">No recurrence</option><option class="svelte-15k7b7r">Weekly</option><option class="svelte-15k7b7r">Monthly</option><option class="svelte-15k7b7r">Yearly</option></select></label> <label class="text-sm svelte-15k7b7r">Interval <input type="number" min="1" class="input svelte-15k7b7r"/></label> <label class="text-sm svelte-15k7b7r">Until <input type="date" class="input svelte-15k7b7r"/></label> <label class="col-span-2 text-sm svelte-15k7b7r">Description <textarea class="col-span-2 textarea svelte-15k7b7r" rows="3" placeholder="Description"></textarea></label></div> <div class="mt-4 flex gap-2 justify-end svelte-15k7b7r"><button class="btn btn-ghost svelte-15k7b7r">Cancel</button> <button class="btn svelte-15k7b7r">Save</button></div></div></div>'),ta=k('<div class="alert alert-error mb-4 svelte-15k7b7r"><svg class="w-6 h-6 svelte-15k7b7r" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 000 2v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" class="svelte-15k7b7r"></path></svg> <div class="svelte-15k7b7r"><p class="font-semibold svelte-15k7b7r">Error:</p> <p class="text-sm svelte-15k7b7r"> </p></div></div>'),aa=k('<div class="text-sm mb-3 text-center svelte-15k7b7r"><div class="loading loading-spinner loading-lg text-primary mb-2 svelte-15k7b7r"></div> <p class="svelte-15k7b7r">Loading Google API...</p></div>'),ra=k('<div class="text-sm mb-3 svelte-15k7b7r"><div class="alert alert-error mb-3 svelte-15k7b7r"><svg class="w-6 h-6 svelte-15k7b7r" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" class="svelte-15k7b7r"></path></svg> <div class="svelte-15k7b7r"><p class="font-semibold svelte-15k7b7r">Google API Loading Failed</p> <p class="text-sm svelte-15k7b7r"> </p> <button class="btn btn-sm btn-outline mt-2 svelte-15k7b7r">üîÑ Retry Loading API</button></div></div></div>'),la=k('<div class="alert alert-success mb-3 svelte-15k7b7r"><svg class="w-6 h-6 svelte-15k7b7r" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 0016 0zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" class="svelte-15k7b7r"></path></svg> You are signed in. Click Import to sync events.</div>'),sa=k('<div class="text-sm mb-3 svelte-15k7b7r"><!></div> <div class="alert alert-warning mb-4 svelte-15k7b7r"><svg class="w-6 h-6 svelte-15k7b7r" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" class="svelte-15k7b7r"></path></svg> <div class="svelte-15k7b7r"><p class="font-semibold svelte-15k7b7r">Setup Required:</p> <ul class="text-sm mt-1 svelte-15k7b7r"><li class="svelte-15k7b7r">‚Ä¢ Create a Google Cloud Project</li> <li class="svelte-15k7b7r">‚Ä¢ Enable Google Calendar API</li> <li class="svelte-15k7b7r">‚Ä¢ Create OAuth 2.0 credentials</li> <li class="svelte-15k7b7r">‚Ä¢ Replace the API keys in the code</li></ul></div></div>',1),oa=k('<div class="text-sm mb-3 svelte-15k7b7r"><strong class="svelte-15k7b7r">Option 1:</strong> Set up Google OAuth (requires API keys)<br class="svelte-15k7b7r"/> <strong class="svelte-15k7b7r">Option 2:</strong> Use OAuth access token (recommended for testing)</div> <div class="alert alert-info mb-4 svelte-15k7b7r"><svg class="w-6 h-6 svelte-15k7b7r" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" class="svelte-15k7b7r"></path></svg> <div class="svelte-15k7b7r"><p class="font-semibold svelte-15k7b7r">How to get OAuth token:</p> <ul class="text-sm mt-1 svelte-15k7b7r"><li class="svelte-15k7b7r">‚Ä¢ Go to <a href="https://developers.google.com/oauthplayground" target="_blank" class="link svelte-15k7b7r">Google OAuth Playground</a></li> <li class="svelte-15k7b7r">‚Ä¢ Select "Google Calendar API v3"</li> <li class="svelte-15k7b7r">‚Ä¢ Authorize and exchange for access token</li> <li class="svelte-15k7b7r">‚Ä¢ Paste the token below</li></ul></div></div> <input class="input w-full mb-3 svelte-15k7b7r" placeholder="Paste OAuth access token here"/>',1),na=k('<div class="loading loading-spinner loading-sm svelte-15k7b7r"></div> Importing...',1),ia=k('<button class="btn btn-primary svelte-15k7b7r"><!></button>'),ca=k('<div class="loading loading-spinner loading-sm svelte-15k7b7r"></div> Connecting...',1),da=k('<button class="btn btn-primary svelte-15k7b7r"><!></button>'),va=k('<div class="loading loading-spinner loading-sm svelte-15k7b7r"></div> Importing...',1),ua=k('<button class="btn btn-primary svelte-15k7b7r"><!></button>'),ba=k('<div class="fixed inset-0 flex items-center justify-center bg-black/40 z-50 svelte-15k7b7r"><div class="bg-base-100 rounded-lg p-6 w-[640px] max-h-[80vh] overflow-y-auto svelte-15k7b7r"><h3 class="text-lg font-semibold mb-3 svelte-15k7b7r">Sync with Google Calendar</h3> <!> <div class="alert alert-info mb-4 svelte-15k7b7r"><svg class="w-6 h-6 svelte-15k7b7r" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" class="svelte-15k7b7r"></path></svg> <div class="svelte-15k7b7r"><p class="font-semibold svelte-15k7b7r">How it works:</p> <ul class="text-sm mt-1 svelte-15k7b7r"><li class="svelte-15k7b7r">‚Ä¢ Click "Connect to Google" to authenticate</li> <li class="svelte-15k7b7r">‚Ä¢ Select your Google account when prompted</li> <li class="svelte-15k7b7r">‚Ä¢ Grant calendar access permission</li> <li class="svelte-15k7b7r">‚Ä¢ Your events will be imported automatically</li></ul></div></div> <!> <div class="flex gap-2 justify-end svelte-15k7b7r"><button class="btn btn-ghost svelte-15k7b7r">Cancel</button> <!></div></div></div>'),ga=k('<div class="modern-calendar svelte-15k7b7r"><div class="action-bar backdrop-blur-lg bg-white/10 border border-white/20 rounded-2xl p-4 mb-6 shadow-xl svelte-15k7b7r"><div class="flex items-center justify-between flex-wrap gap-4 svelte-15k7b7r"><div class="flex items-center gap-4 svelte-15k7b7r"><div class="text-lg font-semibold text-white flex items-center gap-2 svelte-15k7b7r"><span class="text-blue-400 svelte-15k7b7r">üìÖ</span> Calendar Actions</div> <div class="flex items-center gap-2 text-sm text-white/70 svelte-15k7b7r"><span class="w-2 h-2 bg-green-400 rounded-full animate-pulse svelte-15k7b7r"></span> </div></div> <div class="flex items-center gap-3 svelte-15k7b7r"><button class="btn btn-primary btn-sm shadow-lg hover:shadow-xl transition-all duration-300 svelte-15k7b7r"><span class="text-blue-400 svelte-15k7b7r">üîÑ</span> Google Sync</button> <button class="btn btn-secondary btn-sm shadow-lg hover:shadow-xl transition-all duration-300 svelte-15k7b7r"><span class="text-green-400 svelte-15k7b7r">üíæ</span> Export</button> <label class="btn btn-secondary btn-sm cursor-pointer shadow-lg hover:shadow-xl transition-all duration-300 svelte-15k7b7r"><span class="text-purple-400 svelte-15k7b7r">üìÅ</span> Import <input type="file" accept="application/json,.ics" class="hidden svelte-15k7b7r"/></label> <button class="btn btn-warning btn-sm shadow-lg hover:shadow-xl transition-all duration-300 svelte-15k7b7r"><span class="text-orange-400 svelte-15k7b7r">üßπ</span> Clean</button></div></div></div> <div class="calendar-layout grid grid-cols-12 gap-6 svelte-15k7b7r"><aside class="col-span-4 p-4 bg-base-200/80 backdrop-blur-lg rounded-lg shadow-sm border border-white/20 svelte-15k7b7r"><div class="flex items-center justify-between mb-4 svelte-15k7b7r"><div class="font-semibold text-white svelte-15k7b7r"> </div> <div class="flex gap-2 svelte-15k7b7r"><button class="btn btn-ghost btn-sm text-white/80 hover:text-white hover:bg-white/10 svelte-15k7b7r" aria-label="Previous month">‚óÄ</button> <button class="btn btn-ghost btn-sm text-white/80 hover:text-white hover:bg-white/10 svelte-15k7b7r" aria-label="Next month">‚ñ∂</button></div></div> <div class="mini-month grid grid-cols-7 gap-1 text-xs text-center text-white/70 svelte-15k7b7r"><!> <!> <!></div> <div class="mt-4 svelte-15k7b7r"><h4 class="font-medium mb-2 text-white svelte-15k7b7r">Upcoming</h4> <div class="space-y-2 text-sm svelte-15k7b7r"></div></div></aside> <main class="col-span-8 p-6 calendar-container svelte-15k7b7r"><div class="flex items-center justify-between mb-6 svelte-15k7b7r"><div class="text-2xl font-bold calendar-header svelte-15k7b7r">Calendar</div> <div class="flex items-center gap-3 svelte-15k7b7r"><button class="btn btn-primary btn-sm shadow-lg hover:shadow-xl transition-all duration-300 svelte-15k7b7r"><span class="text-green-400 svelte-15k7b7r">+</span> Add Event</button> <div class="text-sm text-white/70 font-medium svelte-15k7b7r">Month view ‚Äî modern redesign</div></div></div> <div class="grid grid-cols-7 gap-4 p-4 svelte-15k7b7r"><!> <!> <!></div></main></div> <!> <!></div>');function pa(we,pt){Ut(pt,!1),window.gapi=window.gapi||{},typeof window<"u"&&(window.gapi=window.gapi||{});let L=O(null);const je=new Date;let D=O(je.getFullYear()),C=O(je.getMonth()),U=O([]),ae=O(!1),Z=O(null),Ne=[{id:"holiday",label:"Holiday",color:"#f97316"},{id:"work",label:"Work",color:"#0ea5e9"},{id:"personal",label:"Personal",color:"#f59e0b"},{id:"family",label:"Family",color:"#10b981"}],ye=Ne.map(e=>e.id),d=O({title:"",date:"",time:"",color:"#0ea5e9",description:"",category:"personal",recurringType:"none",recurringInterval:1,recurringUntil:"",reminderMinutes:0});function Re(e,s){return new Date(e,s+1,0).getDate()}function Be(e,s){return new Date(e,s,1).getDay()}function Le(e,s,a){return`${e}-${String(s+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`}function He(e){return[{title:"Pongal",date:`${e}-01-15`,color:"#f97316",description:"Thai Pongal",category:"holiday"},{title:"Republic Day",date:`${e}-01-26`,color:"#ef4444",description:"National holiday",category:"holiday"},{title:"Holi",date:`${e}-03-08`,color:"#f97316",category:"holiday"},{title:"Good Friday",date:`${e}-04-02`,color:"#0ea5e9",category:"holiday"},{title:"Tamil New Year",date:`${e}-04-14`,color:"#10b981",category:"holiday"},{title:"Labour Day",date:`${e}-05-01`,color:"#06b6d4",category:"holiday"},{title:"Aadi Pooram",date:`${e}-07-21`,color:"#06b6d4",category:"holiday"},{title:"Independence Day",date:`${e}-08-15`,color:"#ef4444",category:"holiday"},{title:"Ganesh Chaturthi",date:`${e}-09-19`,color:"#f59e0b",category:"holiday"},{title:"Navaratri",date:`${e}-10-15`,color:"#f43f5e",category:"holiday"},{title:"Gandhi Jayanti",date:`${e}-10-02`,color:"#f59e0b",category:"holiday"},{title:"Diwali",date:`${e}-11-04`,color:"#8b5cf6",category:"holiday"},{title:"Christmas",date:`${e}-12-25`,color:"#06b6d4",category:"holiday"}]}Ft(async()=>{try{if(navigator.storage&&navigator.storage.persist){const a=await navigator.storage.persist();console.log("Storage persist granted:",a)}}catch(a){console.warn("persist request failed",a)}const e=`calendarSeeded_${t(D)}`;if(!localStorage.getItem(e)){await he("calendar").clear();const a=t(D),r=t(D)+1,o=[...He(a),...He(r)];await ke("calendar",o),localStorage.setItem(e,String(Date.now()))}l(U,await J("calendar"));try{const a=await We();a>0&&(l(U,await J("calendar")),alert(`Removed ${a} duplicate event(s)`))}catch(a){console.error("Failed to dedupe events on load",a)}});function ft(e){const s=e.color||"#0ea5e9",a=ne(s,.9),r=ne(s,.18);return`background: linear-gradient(135deg, ${s}, ${a}); box-shadow: 0 4px 10px ${r};`}function ue(e){const[s,a,r]=(e||"").split("-").map(Number);return new Date(s,(a||1)-1,r||1)}function mt(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function qe(e,s){if(!e)return!1;if(e.date===s)return!0;if(!e.recurring)return!1;const a=ue(e.date),r=ue(s);if(e.recurring.until){const u=ue(e.recurring.until);if(r>u)return!1}if(r<a)return!1;const o=e.recurring.freq,p=e.recurring.interval||1;if(o==="yearly")return a.getDate()===r.getDate()&&a.getMonth()===r.getMonth();if(o==="monthly")return a.getDate()===r.getDate();if(o==="weekly"){const u=Math.floor((r.getTime()-a.getTime())/864e5);return r.getDay()!==a.getDay()?!1:Math.floor(u/7)%p===0}return!1}function ht(e,s,a){const r=[],o=new Date(s),p=new Date(a);for(let u=new Date(o);u<=p;u.setDate(u.getDate()+1)){const f=mt(u);qe(e,f)&&r.push({date:f,event:e})}return r}let se=O(!1),oe=O(""),re=O(!1),ee=O(!1),y=O(!1),P=O(""),be,K=O(!1);function _e(){return window.gapi&&window.gapi.auth2}function xe(){be&&(clearTimeout(be),be=null)}async function Ye(){if(console.log("Starting Google Calendar import..."),l(y,!0),l(P,""),l(se,!0),!t(ee)&&!t(K)){if(console.log("GAPI not loaded, loading script..."),l(K,!0),!window.gapi){const e=document.createElement("script");e.src="https://apis.google.com/js/api.js",be=setTimeout(()=>{console.error("Google API loading timeout"),l(P,"Google API loading timed out. Please check your internet connection and try again."),l(y,!1),l(ee,!1),l(K,!0)},15e3),e.onload=()=>{xe(),console.log("GAPI script loaded, initializing..."),window.gapi.load("client:auth2",()=>{window.gapi.client.init({apiKey:"AIzaSyBhBN7BX9v36dqp-sGClHNc4ngoTMUeIJQ",clientId:"472322435541-1f0f7cje8gicrlamqar1p5p3agbtd0rd.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],scope:"https://www.googleapis.com/auth/calendar.readonly"}).then(()=>{console.log("GAPI initialized successfully"),l(ee,!0),l(re,window.gapi.auth2.getAuthInstance().isSignedIn.get()),console.log("Initial auth state:",t(re)),l(y,!1)}).catch(s=>{console.error("GAPI initialization failed:",s),l(P,"Failed to initialize Google API. Please check your API key and client ID configuration."),l(y,!1),l(ee,!1),l(K,!0)})})},e.onerror=()=>{xe(),console.error("Failed to load Google API script"),l(P,"Failed to load Google API script. Check your internet connection."),l(y,!1),l(ee,!1),l(K,!0)},document.head.appendChild(e)}}else console.log("GAPI already loaded, proceeding with sync..."),Ae()}function Ae(){if(console.log("Proceeding with sync..."),l(y,!0),window.gapi&&window.gapi.auth2){console.log("GAPI available, checking authentication...");const e=window.gapi.auth2.getAuthInstance();e.isSignedIn.get()?(console.log("User already signed in, fetching events..."),l(re,!0),ge()):(console.log("User not signed in, initiating sign in..."),e.signIn({prompt:"select_account"}).then(()=>{console.log("Sign in successful, fetching events..."),l(re,!0),ge()}).catch(s=>{console.error("Sign in failed:",s),l(P,"Google sign-in failed. Please try again or use an OAuth token instead."),l(y,!1)}))}else{if(console.log("GAPI not available, falling back to OAuth token..."),!t(oe)){l(P,"Please paste an OAuth access token or set up OAuth."),l(y,!1);return}ge(t(oe))}}async function ge(e){var s,a,r;console.log("Fetching Google events...",{tokenProvided:!!e}),l(y,!0),l(P,""),l(L,setTimeout(()=>{console.error("Google Calendar import timed out"),l(P,"Import timed out after 30 seconds. Please check your internet connection and try again."),l(y,!1),l(L,null)},3e4));try{let o;if(e){if(console.log("Using OAuth token to fetch events..."),o=await fetch("https://www.googleapis.com/calendar/v3/calendars/primary/events?maxResults=250&singleEvents=true&orderBy=startTime",{headers:{Authorization:`Bearer ${e}`}}),console.log("OAuth token API response status:",o.status),!o.ok)throw o.status===401?new Error("Invalid or expired OAuth token. Please get a new token from Google OAuth Playground."):o.status===403?new Error("Access denied. Please check that your token has Calendar API permissions."):o.status===404?new Error("Calendar not found. Please check your Google account."):o.status>=500?new Error("Google Calendar API server error. Please try again later."):new Error(`HTTP ${o.status}: ${o.statusText}`)}else{console.log("Using GAPI client to fetch events...");try{o=await window.gapi.client.calendar.events.list({calendarId:"primary",timeMin:new Date().toISOString(),showDeleted:!1,singleEvents:!0,maxResults:250,orderBy:"startTime"}),console.log("GAPI client response received")}catch(f){throw console.error("GAPI client error:",f),new Error(`Google API Error: ${((a=(s=f.result)==null?void 0:s.error)==null?void 0:a.message)||f.message||"Authentication or API access failed"}`)}}clearTimeout(t(L)),l(L,null),console.log("API response received:",o);const p=e?await o.json():o.result;if(console.log("Parsed data:",p),e&&!o.ok)throw new Error(((r=p.error)==null?void 0:r.message)||`HTTP ${o.status}: ${o.statusText}`);const u=(p.items||[]).map(f=>{var $,M,j,H,T,v;return{title:f.summary||"Event",date:(($=f.start)==null?void 0:$.date)||((j=(M=f.start)==null?void 0:M.dateTime)==null?void 0:j.split("T")[0])||"",time:(H=f.start)!=null&&H.dateTime?(T=f.start.dateTime.split("T")[1])==null?void 0:T.slice(0,5):((v=f.start)!=null&&v.date,""),color:"#0ea5e9",description:f.description||""}});console.log(`Parsed ${u.length} events:`,u),u.length&&(console.log("Saving events to database..."),await ke("calendar",u),console.log("Events saved successfully")),l(U,await J("calendar")),console.log(`Total events in database: ${t(U).length}`),l(y,!1),l(se,!1),l(P,""),alert(`‚úÖ Successfully imported ${u.length} events from Google Calendar!`)}catch(o){clearTimeout(t(L)),l(L,null),console.error("Failed to import from Google Calendar:",o),l(P,`Failed to import from Google Calendar: ${o.message||"Unknown error"}`),l(y,!1)}}function kt(e){const s=e.target,a=s.files&&s.files[0];if(!a)return;const r=new FileReader;r.onload=async()=>{const u=(String(r.result||"").match(/BEGIN:VEVENT[\s\S]*?END:VEVENT/g)||[]).map(f=>{const $=(f.match(/SUMMARY:(.*)/)||[null,""])[1].trim(),M=(f.match(/DTSTART(?:;[^:]*)?:(.*)/)||[null,""])[1].trim(),j=M?M.slice(0,8).replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"):"";return{title:$||"Event",date:j,time:"",color:"#0ea5e9"}});u.length&&await ke("calendar",u),l(U,await J("calendar")),alert(`Imported ${u.length} events from ICS.`)},r.readAsText(a)}function wt(e){const s=Le(t(D),t(C),e);return t(U).filter(a=>{const r=a.category||"personal";return ye.includes(r)?qe(a,s):!1}).sort((a,r)=>a.time?-1:0)}function yt(){const e=[],s=new Date,a=new Date;a.setDate(a.getDate()+30);for(const r of t(U)){const o=r.category||"personal";if(!ye.includes(o))continue;const p=ht(r,s,a);for(const u of p)e.push({...u,ev:r})}for(const r of t(U)){const o=r.category||"personal";if(ye.includes(o)&&!r.recurring){const p=ue(r.date);p>=s&&p<=a&&e.push({date:r.date,event:r})}}return e.sort((r,o)=>r.date>o.date?1:r.date<o.date?-1:0),e.slice(0,6)}function ne(e,s=1){if(!e)return`rgba(0,0,0,${s})`;const a=e.replace("#",""),r=parseInt(a.length===3?a.split("").map(f=>f+f).join(""):a,16),o=r>>16&255,p=r>>8&255,u=r&255;return`rgba(${o}, ${p}, ${u}, ${s})`}function _t(){l(C,t(C)-1),t(C)<0&&(l(C,11),l(D,t(D)-1))}function xt(){l(C,t(C)+1),t(C)>11&&(l(C,0),l(D,t(D)+1))}function Ie(e){l(ae,!0),l(Z,null),l(d,{title:"",date:Le(t(D),t(C),e),time:"",color:"#0ea5e9",description:"",category:"personal",recurringType:"none",recurringInterval:1,recurringUntil:"",reminderMinutes:0})}function Ve(e){l(Z,e.id),l(d,{title:e.title||"",date:e.date,time:e.time||"",color:e.color||"#0ea5e9",description:e.description||"",category:e.category||"personal",recurringType:e.recurring?e.recurring.freq:"none",recurringInterval:e.recurring&&e.recurring.interval||1,recurringUntil:e.recurring&&e.recurring.until||"",reminderMinutes:e.reminderMinutes||0}),l(ae,!0)}async function At(){if(!t(d).title||!t(d).date){alert("Please provide a title and date");return}try{const e=t(d).recurringType&&t(d).recurringType!=="none"?{freq:t(d).recurringType,interval:Number(t(d).recurringInterval||1),until:t(d).recurringUntil||null}:null,s={title:String(t(d).title),date:String(t(d).date),time:t(d).time||"",color:t(d).color||"#0ea5e9",description:t(d).description||"",category:t(d).category||"personal",recurring:e,reminderMinutes:Number(t(d).reminderMinutes||0)};if(console.log("Saving event payload:",s,"editing:",t(Z)),t(Z)){const a=await he("calendar").update(t(Z),s);console.log("Update result:",a)}else{const a=await he("calendar").add(s);console.log("Added event id:",a)}l(U,await J("calendar")),l(ae,!1),l(Z,null),alert("Event saved")}catch(e){console.error("Failed to save event",e),alert("Failed to save event ‚Äî see console")}}async function We(){const e=await J("calendar"),s=new Map,a=[];for(const r of e){const o=`${(r.title||"").trim().toLowerCase()}|${r.date||""}|${r.time||""}`;s.has(o)?a.push(r.id):s.set(o,r.id)}for(const r of a)await he("calendar").delete(r);return a.length}Lt();var Pe=ga(),Te=c(Pe),Je=c(Te),Se=c(Je),Ke=i(c(Se),2),It=i(c(Ke));n(Ke),n(Se);var Qe=i(Se,2),Xe=c(Qe),Ze=i(Xe,2),Ge=i(Ze,2),Pt=i(c(Ge),2);n(Ge);var Tt=i(Ge,2);n(Qe),n(Je),n(Te);var Ce=i(Te,2),De=c(Ce),$e=c(De),Me=c($e),St=c(Me,!0);n(Me);var et=i(Me,2),tt=c(et),Gt=i(tt,2);n(et),n($e);var Ee=i($e,2),at=c(Ee);V(at,0,()=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],W,(e,s)=>{var a=Ht(),r=c(a,!0);n(a),G(()=>R(r,s)),b(e,a)});var rt=i(at,2);V(rt,1,()=>Array(Be(t(D),t(C))).fill(0),W,(e,s)=>{var a=qt();b(e,a)});var Ct=i(rt,2);V(Ct,1,()=>Array(Re(t(D),t(C))),W,(e,s,a)=>{var r=Yt();r.textContent=a+1,A("click",r,()=>{Ie(a+1)}),A("keydown",r,o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),Ie(a+1))}),b(e,r)}),n(Ee);var lt=i(Ee,2),st=i(c(lt),2);V(st,5,yt,W,(e,s)=>{var a=Vt(),r=c(a),o=i(r,2),p=c(o),u=i(p),f=c(u);n(u),n(o),n(a),G(()=>{Ue(r,`background:${t(s).event.color??""}`),R(p,`${t(s).event.title??""} `),R(f,`${t(s).date??""}${t(s).event.time?` ‚Ä¢ ${t(s).event.time}`:""}`)}),b(e,a)}),n(st),n(lt),n(De);var ot=i(De,2),Oe=c(ot),nt=i(c(Oe),2),Dt=c(nt);de(2),n(nt),n(Oe);var it=i(Oe,2),ct=c(it);V(ct,0,()=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],W,(e,s)=>{var a=Wt(),r=c(a),o=c(r,!0);n(r),n(a),G(()=>R(o,s)),b(e,a)});var dt=i(ct,2);V(dt,1,()=>Array(Be(t(D),t(C))).fill(0),W,(e,s)=>{var a=Jt();b(e,a)});var $t=i(dt,2);V($t,1,()=>Array(Re(t(D),t(C))),W,(e,s,a)=>{const r=Nt(()=>wt(a+1));var o=Xt(),p=c(o),u=c(p);u.textContent=a+1;var f=i(u,2);n(p);var $=i(p,2),M=c($);V(M,1,()=>t(r).slice(0,3),W,(T,v)=>{var g=Kt(),S=c(g),E=c(S);n(S),n(g),G(I=>{Ue(S,I),R(E,`${t(v).time?t(v).time+" ‚Ä¢ ":""}${t(v).title??""}`)},[()=>ft(t(v))]),A("click",g,()=>Ve(t(v))),A("keydown",g,I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),Ve(t(v)))}),b(T,g)});var j=i(M,2);{var H=T=>{var v=Qt(),g=c(v);n(v),G(()=>R(g,`+${t(r).length-3} more`)),b(T,v)};F(j,T=>{t(r).length>3&&T(H)})}n($),n(o),G((T,v,g)=>{Bt(o,"data-has-events",t(r).length>0),Ue(o,`
              --day-border: ${T??""};
              --day-border-alt: ${v??""};
              --event-color: ${(t(r).length&&t(r)[0].color||"#6366f1")??""};
              --event-color-alt: ${g??""};
            `)},[()=>t(r).length?ne(t(r)[0].color||"#6366f1",.6):"rgba(255,255,255,0.1)",()=>t(r).length?ne(t(r)[0].color||"#8b5cf6",.4):"rgba(255,255,255,0.05)",()=>t(r).length?ne(t(r)[0].color||"#8b5cf6",.8):"#8b5cf6"]),A("click",f,()=>Ie(a+1)),b(e,o)}),n(it),n(ot),n(Ce);var vt=i(Ce,2);{var Mt=e=>{var s=ea(),a=c(s),r=c(a),o=c(r,!0);n(r);var p=i(r,2),u=c(p),f=i(c(u));te(f),n(u);var $=i(u,2),M=i(c($));te(M),n($);var j=i($,2),H=i(c(j));te(H),n(j);var T=i(j,2),v=i(c(T));te(v),n(T);var g=i(T,2),S=i(c(g));G(()=>{t(d),bt(()=>{})}),V(S,5,()=>Ne,W,(x,ze)=>{var ce=Zt(),zt=c(ce,!0);n(ce);var ut={};G(()=>{R(zt,t(ze).label),ut!==(ut=t(ze).id)&&(ce.value=(ce.__value=t(ze).id)??"")}),b(x,ce)}),n(S),n(g);var E=i(g,2),I=i(c(E));G(()=>{t(d),bt(()=>{})});var w=c(I);w.value=w.__value="none";var m=i(w);m.value=m.__value="weekly";var N=i(m);N.value=N.__value="monthly";var B=i(N);B.value=B.__value="yearly",n(I),n(E);var z=i(E,2),h=i(c(z));te(h),n(z);var _=i(z,2),Q=i(c(_));te(Q),n(_);var le=i(_,2),pe=i(c(le));Rt(pe),n(le),n(p);var fe=i(p,2),q=c(fe),ie=i(q,2);n(fe),n(a),n(s),G(()=>R(o,t(Z)?"Edit event":"Add event")),X(f,()=>t(d).title,x=>Y(d,t(d).title=x)),X(M,()=>t(d).date,x=>Y(d,t(d).date=x)),X(H,()=>t(d).time,x=>Y(d,t(d).time=x)),X(v,()=>t(d).color,x=>Y(d,t(d).color=x)),gt(S,()=>t(d).category,x=>Y(d,t(d).category=x)),gt(I,()=>t(d).recurringType,x=>Y(d,t(d).recurringType=x)),X(h,()=>t(d).recurringInterval,x=>Y(d,t(d).recurringInterval=x)),X(Q,()=>t(d).recurringUntil,x=>Y(d,t(d).recurringUntil=x)),X(pe,()=>t(d).description,x=>Y(d,t(d).description=x)),A("click",q,()=>l(ae,!1)),A("click",ie,At),b(e,s)};F(vt,e=>{t(ae)&&e(Mt)})}var Et=i(vt,2);{var Ot=e=>{var s=ba(),a=c(s),r=i(c(a),2);{var o=v=>{var g=ta(),S=i(c(g),2),E=i(c(S),2),I=c(E,!0);n(E),n(S),n(g),G(()=>R(I,t(P))),b(v,g)};F(r,v=>{t(P)&&v(o)})}var p=i(r,4);{var u=v=>{var g=aa();b(v,g)},f=v=>{var g=Fe(),S=ve(g);{var E=w=>{var m=ra(),N=c(m),B=i(c(N),2),z=i(c(B),2),h=c(z,!0);n(z);var _=i(z,2);n(B),n(N),n(m),G(()=>R(h,t(P)||"Unable to load Google Calendar API. Try using the OAuth token method instead.")),A("click",_,()=>{l(K,!1),l(P,""),Ye()}),b(w,m)},I=w=>{var m=Fe(),N=ve(m);{var B=h=>{var _=sa(),Q=ve(_),le=c(Q);{var pe=q=>{var ie=la();b(q,ie)},fe=q=>{var ie=me('Click "Connect to Google" to sign in and sync.');b(q,ie)};F(le,q=>{t(re)?q(pe):q(fe,!1)})}n(Q),de(2),b(h,_)},z=h=>{var _=oa(),Q=i(ve(_),4);te(Q),X(Q,()=>t(oe),le=>l(oe,le)),b(h,_)};F(N,h=>{_e()?h(B):h(z,!1)},!0)}b(w,m)};F(S,w=>{!t(ee)&&t(K)?w(E):w(I,!1)},!0)}b(v,g)};F(p,v=>{!t(ee)&&!t(K)?v(u):v(f,!1)})}var $=i(p,2),M=c($),j=i(M,2);{var H=v=>{var g=ia(),S=c(g);{var E=w=>{var m=na();de(),b(w,m)},I=w=>{var m=me("Import Events");b(w,m)};F(S,w=>{t(y)?w(E):w(I,!1)})}n(g),G(()=>g.disabled=t(y)),A("click",g,ge),b(v,g)},T=v=>{var g=Fe(),S=ve(g);{var E=w=>{var m=da(),N=c(m);{var B=h=>{var _=ca();de(),b(h,_)},z=h=>{var _=me("Connect to Google");b(h,_)};F(N,h=>{t(y)?h(B):h(z,!1)})}n(m),G(()=>m.disabled=t(y)),A("click",m,Ae),b(w,m)},I=w=>{var m=ua(),N=c(m);{var B=h=>{var _=va();de(),b(h,_)},z=h=>{var _=me("Import with Token");b(h,_)};F(N,h=>{t(y)?h(B):h(z,!1)})}n(m),G(()=>m.disabled=t(y)),A("click",m,()=>{t(oe)?Ae():l(P,"Please paste an OAuth access token.")}),b(w,m)};F(S,w=>{_e()?w(E):w(I,!1)},!0)}b(v,g)};F(j,v=>{_e()&&t(re)?v(H):v(T,!1)})}n($),n(a),n(s),A("click",M,()=>{l(se,!1),l(P,""),l(y,!1),xe(),t(L)&&(clearTimeout(t(L)),l(L,null))}),b(e,s)};F(Et,e=>{t(se)&&e(Ot)})}n(Pe),G(e=>{R(It,` ${t(U).length??""} events loaded`),R(St,e)},[()=>new Date(t(D),t(C)).toLocaleString("default",{month:"long",year:"numeric"})]),A("click",Xe,()=>{l(se,!0),Ye()}),A("click",Ze,async()=>{const e=await J("calendar"),s=JSON.stringify(e,null,2),a=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=`calendar-export-${Date.now()}.json`,o.click(),URL.revokeObjectURL(r)}),A("change",Pt,async e=>{const s=e.target,a=s.files&&s.files[0];if(a)if(a.name.endsWith(".ics"))kt(e);else{const r=await a.text();try{const o=JSON.parse(r);Array.isArray(o)&&(await ke("calendar",o),l(U,await J("calendar")),alert("Imported successfully"))}catch(o){alert("Failed to import JSON"),console.error(o)}}}),A("click",Tt,async()=>{const e=await We();l(U,await J("calendar")),alert(`Removed ${e} duplicate event(s)`)}),A("click",tt,_t),A("click",Gt,xt),A("click",Dt,()=>l(ae,!0)),b(we,Pe),jt()}function Pa(we){pa(we,{})}export{Pa as default};
