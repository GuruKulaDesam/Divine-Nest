import{w as x}from"./BJQBB4-K.js";import{a as b,r as f,e as w,n as A}from"./CuaUlsyi.js";import{_ as z}from"./Dp1pzeXC.js";class m{constructor(e,t=[]){this.name=e,this.capabilities=t,this.memory=new Map,this.goals=[],this.isActive=!1}async initialize(){this.isActive=!0,console.log(`${this.name} agent initialized`)}async shutdown(){this.isActive=!1,console.log(`${this.name} agent shutdown`)}async process(e){return this.isActive?(this.memory.set(Date.now(),e),await this.execute(e)):null}async execute(e){return{response:"Base agent response",actions:[]}}addGoal(e){this.goals.push(e)}getMemory(e=10){return Array.from(this.memory.entries()).slice(-e).map(([n,s])=>({timestamp:new Date(n),data:s}))}}class S{constructor(){this.agents=new Map,this.activeRole="family",this.roles={paati:{name:"Paati",preferences:{tone:"gentle",language:"tamil",pace:"slow"}},appa:{name:"Appa",preferences:{tone:"practical",language:"english",pace:"efficient"}},amma:{name:"Amma",preferences:{tone:"nurturing",language:"mixed",pace:"organized"}},kids:{name:"Kids",preferences:{tone:"playful",language:"english",pace:"fun"}},family:{name:"Family",preferences:{tone:"warm",language:"mixed",pace:"balanced"}}}}registerAgent(e){this.agents.set(e.name,e)}setActiveRole(e){this.roles[e]&&(this.activeRole=e,console.log(`Active role changed to: ${this.roles[e].name}`))}getRolePreferences(){return this.roles[this.activeRole].preferences}async processWithAgents(e,t={}){const n=[],s=this.getRolePreferences(),i={...e,role:this.activeRole,preferences:s,context:t};for(const[a,o]of this.agents)try{const c=await o.process(i);c&&n.push({agent:a,result:c})}catch(c){console.error(`Error in ${a} agent:`,c)}return this.orchestrateResponses(n,i)}orchestrateResponses(e,t){const n=e.sort((i,a)=>{const o=["memory","planner","voice","ui","tool","music"],c=o.indexOf(i.agent),u=o.indexOf(a.agent);return c-u});return{responses:n.map(i=>i.result.response).filter(i=>i),actions:n.flatMap(i=>i.result.actions||[]),role:t.role,preferences:t.preferences}}async initializeAllAgents(){for(const e of this.agents.values())await e.initialize()}async shutdownAllAgents(){for(const e of this.agents.values())await e.shutdown()}}const l=new S,p=x({activeRole:"family",activeAgents:[],lastInteraction:null,memory:[],goals:[]});class M extends m{constructor(){super("memory",["store","recall","learn","context"]),this.longTermMemory=new Map,this.shortTermMemory=[],this.emotionalContext=new Map,this.userProfiles=new Map,this.routines=new Map}async initialize(){await super.initialize(),this.loadPersistedMemory(),this.initializeDefaultProfiles()}initializeDefaultProfiles(){this.userProfiles.set("paati",{name:"Paati",preferences:{tone:"gentle",language:"tamil",pace:"slow",interests:["devotional","health","family"],routines:["morning_prayers","temple_visits","grandchildren_time"]},emotional_patterns:["gratitude","concern","peace"],facts:["prefers_soft_reminders","loves_devotional_music","needs_help_with_technology"]}),this.userProfiles.set("appa",{name:"Appa",preferences:{tone:"practical",language:"english",pace:"efficient",interests:["work","health","projects"],routines:["morning_walk","work_tasks","family_time"]},emotional_patterns:["focused","concerned","proud"],facts:["early_riser","loves_voice_to_music","manages_finances"]}),this.userProfiles.set("amma",{name:"Amma",preferences:{tone:"nurturing",language:"mixed",pace:"organized",interests:["cooking","health","children"],routines:["meal_planning","shopping","wellness"]},emotional_patterns:["caring","worried","joyful"],facts:["meal_planner","health_conscious","manages_household"]}),this.userProfiles.set("kids",{name:"Kids",preferences:{tone:"playful",language:"english",pace:"fun",interests:["games","learning","stories"],routines:["school","playtime","bedtime_stories"]},emotional_patterns:["excited","curious","tired"],facts:["love_stories","learning_oriented","need_routines"]})}async execute(e){const{type:t,data:n,role:s}=e;switch(t){case"store_fact":return this.storeFact(n,s);case"recall_context":return this.recallContext(s,n==null?void 0:n.category);case"update_emotion":return this.updateEmotionalContext(s,n==null?void 0:n.emotion);case"learn_routine":return this.learnRoutine(n,s);case"get_profile":return this.getUserProfile(s);default:return this.provideContext(e)}}storeFact(e,t){const n=`${t}_${Date.now()}`;return this.longTermMemory.set(n,{fact:e,role:t,timestamp:new Date,confidence:1}),{response:`Learned: ${e}`,actions:[{type:"memory_stored",data:{key:n,fact:e,role:t}}]}}recallContext(e,t=null){const n=Array.from(this.longTermMemory.values()).filter(a=>a.role===e).filter(a=>!t||this.categorizeFact(a.fact)===t).sort((a,o)=>o.timestamp-a.timestamp).slice(0,5),s=this.userProfiles.get(e),i=this.emotionalContext.get(e)||"neutral";return{response:`Context for ${e}: ${n.length} relevant facts, emotional state: ${i}`,actions:[],context:{facts:n,profile:s,emotionalState:i,routines:this.routines.get(e)||[]}}}updateEmotionalContext(e,t){this.emotionalContext.set(e,t);const n=`emotion_${e}_${Date.now()}`;return this.longTermMemory.set(n,{fact:`Felt ${t}`,role:e,timestamp:new Date,type:"emotion",confidence:.8}),{response:`Emotional context updated for ${e}: ${t}`,actions:[{type:"emotion_updated",data:{role:e,emotion:t}}]}}learnRoutine(e,t){const n=this.routines.get(t)||[];return n.push({...e,learned:new Date,confidence:.6}),this.routines.set(t,n),{response:`Learned routine for ${t}: ${e.name}`,actions:[{type:"routine_learned",data:{role:t,routine:e}}]}}getUserProfile(e){const t=this.userProfiles.get(e);return t?{response:`Profile loaded for ${t.name}`,actions:[],profile:t}:{response:`No profile found for ${e}`,actions:[]}}provideContext(e){const t=e.role||"family",n=this.userProfiles.get(t),s=this.emotionalContext.get(t)||"neutral",i=Array.from(this.longTermMemory.values()).filter(a=>a.role===t).sort((a,o)=>o.timestamp-a.timestamp).slice(0,3);return{response:`Context provided for ${t}`,actions:[],context:{profile:n,emotionalState:s,recentFacts:i,preferences:(n==null?void 0:n.preferences)||{}}}}categorizeFact(e){const t={preference:["prefers","likes","loves","needs"],routine:["every day","usually","always","schedule"],health:["health","medicine","doctor","pain","tired"],emotion:["happy","sad","worried","excited","grateful"],family:["family","children","parents","relatives"]};for(const[n,s]of Object.entries(t))if(s.some(i=>e.toLowerCase().includes(i)))return n;return"general"}loadPersistedMemory(){try{const e=localStorage.getItem("shivo_memory");if(e){const t=JSON.parse(e);this.longTermMemory=new Map(t.longTermMemory||[]),this.emotionalContext=new Map(t.emotionalContext||[]),this.routines=new Map(t.routines||[])}}catch(e){console.warn("Failed to load persisted memory:",e)}}persistMemory(){try{const e={longTermMemory:Array.from(this.longTermMemory.entries()),emotionalContext:Array.from(this.emotionalContext.entries()),routines:Array.from(this.routines.entries())};localStorage.setItem("shivo_memory",JSON.stringify(e))}catch(e){console.warn("Failed to persist memory:",e)}}startAutoPersist(){setInterval(()=>this.persistMemory(),3e4)}}class P extends m{constructor(){super("planner",["schedule","remind","plan","coordinate"]),this.activePlans=new Map,this.routines=new Map,this.timeTriggers=new Map}async initialize(){await super.initialize(),this.initializeDefaultRoutines(),this.startTimeMonitoring()}initializeDefaultRoutines(){this.routines.set("paati",[{name:"morning_prayers",time:"06:00",action:"remind_prayer"},{name:"temple_visit",time:"07:00",days:[1,3,5],action:"plan_temple"},{name:"grandchildren_time",time:"16:00",action:"remind_family_time"},{name:"evening_meditation",time:"19:00",action:"suggest_meditation"}]),this.routines.set("appa",[{name:"morning_walk",time:"05:30",action:"remind_walk"},{name:"work_start",time:"09:00",action:"check_tasks"},{name:"lunch_break",time:"13:00",action:"suggest_meal"},{name:"family_time",time:"18:00",action:"plan_family_activity"}]),this.routines.set("amma",[{name:"meal_prep",time:"07:00",action:"plan_meals"},{name:"shopping_list",time:"10:00",action:"review_grocery"},{name:"kids_pickup",time:"15:30",action:"remind_pickup"},{name:"evening_routine",time:"20:00",action:"start_bedtime"}]),this.routines.set("kids",[{name:"school_prep",time:"07:30",action:"remind_school"},{name:"study_time",time:"17:00",action:"start_homework"},{name:"playtime",time:"16:00",action:"suggest_activities"},{name:"bedtime_story",time:"20:30",action:"tell_story"}])}async execute(e){const{type:t,data:n,role:s,preferences:i}=e;switch(t){case"create_plan":return this.createPlan(n,s);case"schedule_task":return this.scheduleTask(n,s);case"check_routines":return this.checkRoutines(s);case"coordinate_activity":return this.coordinateActivity(n,s);case"time_trigger":return this.handleTimeTrigger(n);default:return this.analyzeAndPlan(e)}}createPlan(e,t){const n=`plan_${t}_${Date.now()}`,s={id:n,...e,role:t,created:new Date,status:"active",steps:e.steps||[],deadline:e.deadline||null};return this.activePlans.set(n,s),{response:`Created plan: ${e.title} for ${t}`,actions:[{type:"plan_created",data:s},{type:"schedule_reminders",data:{planId:n,steps:s.steps}}]}}scheduleTask(e,t){const n={...e,role:t,scheduled:new Date,status:"pending"};return n.type==="todo"?b.update(s=>[...s,{...n,id:Date.now(),completed:!1}]):n.type==="reminder"?f.update(s=>[...s,{...n,id:Date.now(),completed:!1}]):n.type==="event"&&w.update(s=>[...s,{...n,id:Date.now()}]),{response:`Scheduled ${n.type}: ${n.title} for ${t}`,actions:[{type:"task_scheduled",data:n}]}}checkRoutines(e){const t=new Date,n=t.toTimeString().slice(0,5),s=t.getDay(),a=(this.routines.get(e)||[]).filter(o=>{const c=o.time===n,u=!o.days||o.days.includes(s);return c&&u});if(a.length>0){const o=a.map(c=>({type:c.action,data:{routine:c.name,role:e,time:c.time}}));return{response:`Time for ${e}'s ${a.map(c=>c.name).join(", ")}`,actions:o}}return{response:`No routines due for ${e} at this time`,actions:[]}}coordinateActivity(e,t){const n={activity:e.title,participants:e.participants||[t],time:e.time,coordination:this.generateCoordinationPlan(e,t)};return{response:`Coordinated ${e.title} for ${n.participants.join(", ")}`,actions:[{type:"activity_coordinated",data:n},{type:"send_notifications",data:{activity:n}}]}}handleTimeTrigger(e){const{time:t,action:n,context:s}=e;switch(n){case"remind_prayer":return this.createPrayerReminder(s);case"plan_temple":return this.planTempleVisit(s);case"remind_walk":return this.createWalkReminder(s);case"check_tasks":return this.checkPendingTasks(s);case"suggest_meal":return this.suggestMealBreak(s);case"plan_meals":return this.planMeals(s);case"remind_pickup":return this.createPickupReminder(s);case"start_bedtime":return this.startBedtimeRoutine(s);default:return{response:`Unknown time trigger: ${n}`,actions:[]}}}analyzeAndPlan(e){const{text:t,role:n,preferences:s}=e;return t.includes("tired")||t.includes("rest")?this.createRestPlan(n):t.includes("hungry")||t.includes("eat")?this.createMealPlan(n):t.includes("busy")||t.includes("work")?this.createFocusPlan(n):{response:`Analyzed input for ${n}, no specific plan needed`,actions:[]}}createPrayerReminder(e){return{response:"Time for morning prayers",actions:[{type:"create_reminder",data:{title:"Morning Prayers",message:"Time for your daily prayers and meditation",time:new Date(Date.now()+300*1e3).toISOString(),role:e.role}}]}}planTempleVisit(e){const t=new Date;return new Date(t).setHours(7,0,0,0),{response:"Planning temple visit for today",actions:[{type:"create_event",data:{title:"Temple Visit",date:t.toISOString().split("T")[0],time:"07:00",category:"spiritual",role:e.role}}]}}createWalkReminder(e){return{response:"Time for your morning walk",actions:[{type:"create_reminder",data:{title:"Morning Walk",message:"Time for your daily walk - stay healthy!",time:new Date(Date.now()+600*1e3).toISOString(),role:e.role}}]}}checkPendingTasks(e){return{response:"Checking your pending tasks for today",actions:[{type:"review_tasks",data:{role:e.role}}]}}suggestMealBreak(e){return{response:"Time for lunch break",actions:[{type:"create_reminder",data:{title:"Lunch Break",message:"Take a break and have your meal",time:new Date(Date.now()+300*1e3).toISOString(),role:e.role}}]}}planMeals(e){return{response:"Planning meals for the day",actions:[{type:"plan_meals",data:{role:e.role}}]}}createPickupReminder(e){return{response:"Time to pick up the children",actions:[{type:"create_reminder",data:{title:"School Pickup",message:"Time to pick up the children from school",time:new Date(Date.now()+300*1e3).toISOString(),role:e.role}}]}}startBedtimeRoutine(e){return{response:"Starting bedtime routine for the children",actions:[{type:"create_reminder",data:{title:"Bedtime Story",role:"kids"}},{type:"dim_lights",data:{}},{type:"play_soft_music",data:{}}]}}createRestPlan(e){return{response:`Creating a rest plan for ${e}`,actions:[{type:"create_plan",data:{title:"Rest and Recovery",steps:["Take a short break","Drink water","Do deep breathing","Rest for 15 minutes"],role:e}}]}}createMealPlan(e){return{response:`Planning a meal for ${e}`,actions:[{type:"suggest_meal",data:{role:e,time:new Date().toTimeString().slice(0,5)}}]}}createFocusPlan(e){return{response:`Creating focus plan for ${e}`,actions:[{type:"create_plan",data:{title:"Focus Session",steps:["Clear workspace","Set timer for 25 minutes","Work without distractions","Take a 5-minute break"],role:e}}]}}generateCoordinationPlan(e,t){return[`Notify all participants about ${e.title}`,`Check availability for ${e.time}`,"Prepare necessary items","Confirm participation","Execute activity"]}startTimeMonitoring(){setInterval(()=>{this.checkAllRoutines()},6e4)}checkAllRoutines(){["paati","appa","amma","kids"].forEach(t=>{const n=this.checkRoutines(t);n.actions.length>0&&n.actions.forEach(s=>{this.handleTimeTrigger({time:new Date().toTimeString().slice(0,5),action:s.type,context:{role:t}})})})}}class $ extends m{constructor(){super("voice",["listen","speak","analyze","transcribe"]),this.isListening=!1,this.recognition=null,this.synthesis=null,this.emotionAnalyzer=new R,this.intentParser=new T,this.languageDetector=new C}async initialize(){await super.initialize(),this.initializeSpeechRecognition(),this.initializeSpeechSynthesis()}initializeSpeechRecognition(){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const e=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new e,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="en-IN",this.recognition.onresult=t=>{let n="";for(let s=t.resultIndex;s<t.results.length;s++){const i=t.results[s][0].transcript;t.results[s].isFinal&&(n+=i)}n&&this.processTranscript(n)},this.recognition.onerror=t=>{console.error("Speech recognition error:",t.error)}}}initializeSpeechSynthesis(){"speechSynthesis"in window&&(this.synthesis=window.speechSynthesis,this.voicePreferences={paati:{lang:"ta-IN",rate:.8,pitch:1.1},appa:{lang:"en-IN",rate:1,pitch:1},amma:{lang:"en-IN",rate:.9,pitch:1},kids:{lang:"en-IN",rate:1.1,pitch:1.2},family:{lang:"en-IN",rate:.95,pitch:1}})}async execute(e){const{type:t,data:n,role:s,preferences:i}=e;switch(t){case"start_listening":return this.startListening(s);case"stop_listening":return this.stopListening();case"speak_response":return this.speakResponse(n.text,s);case"analyze_emotion":return this.analyzeEmotion(n.audio||n.text);case"process_command":return this.processCommand(n.text,s);default:return this.handleVoiceInput(e)}}startListening(e){if(this.recognition&&!this.isListening){const t=this.voicePreferences[e]||this.voicePreferences.family;return this.recognition.lang=t.lang,this.recognition.start(),this.isListening=!0,{response:`Started listening for ${e}`,actions:[{type:"listening_started",data:{role:e}}]}}return{response:"Speech recognition not available or already listening",actions:[]}}stopListening(){return this.recognition&&this.isListening?(this.recognition.stop(),this.isListening=!1,{response:"Stopped listening",actions:[{type:"listening_stopped"}]}):{response:"Not currently listening",actions:[]}}async speakResponse(e,t){if(!this.synthesis)return{response:"Speech synthesis not available",actions:[]};const n=new SpeechSynthesisUtterance(e),s=this.voicePreferences[t]||this.voicePreferences.family;n.lang=s.lang,n.rate=s.rate,n.pitch=s.pitch;const a=this.synthesis.getVoices().find(o=>o.lang.startsWith(s.lang.split("-")[0]));return a&&(n.voice=a),this.synthesis.speak(n),{response:`Speaking response for ${t}`,actions:[{type:"speech_started",data:{text:e,role:t}}]}}async analyzeEmotion(e){const t=await this.emotionAnalyzer.analyze(e);return{response:`Detected emotion: ${t.primary}`,actions:[{type:"emotion_detected",data:t},{type:"update_memory",data:{type:"emotion",emotion:t.primary}}],emotion:t}}async processCommand(e,t){const n=this.languageDetector.detect(e),s=await this.intentParser.parse(e,t,n),i=await this.emotionAnalyzer.analyze(e);return{response:`Processed command for ${t}`,actions:[{type:"intent_parsed",data:s},{type:"emotion_analyzed",data:i},{type:"execute_intent",data:{intent:s,role:t,language:n,emotion:i}}],intent:s,emotion:i,language:n}}async processTranscript(e){return console.log("Processing transcript:",e),["shivo","சிவோ","nanbaa","நண்பா","ai","assistant"].some(s=>e.toLowerCase().includes(s.toLowerCase()))?{...await this.processCommand(e,"family"),wakeWord:!0}:await this.processCommand(e,"family")}handleVoiceInput(e){const{audio:t,text:n,role:s}=e;return t?this.processAudio(t,s):n?this.processCommand(n,s):{response:"No audio or text input provided",actions:[]}}async processAudio(e,t){const n=await this.transcribeAudio(e),s=await this.emotionAnalyzer.analyzeAudio(e);return{...await this.processCommand(n,t),transcript:n,emotion:s}}async transcribeAudio(e){return"Transcribed text from audio"}}class R{async analyze(e){const t={joy:["happy","excited","wonderful","great","love","மகிழ்ச்சி","சந்தோஷம்"],stress:["worried","stressed","anxious","tired","பதற்றம்","கவலை"],gratitude:["thank you","grateful","blessed","நன்றி","நன்றாக"],neutral:["okay","fine","alright","சரி","நல்லது"]},n=typeof e=="string"?e.toLowerCase():"",s={};for(const[a,o]of Object.entries(t))s[a]=o.reduce((c,u)=>c+(n.includes(u)?1:0),0);return{primary:Object.entries(s).reduce((a,o)=>s[a[0]]>s[o[0]]?a:o)[0],scores:s,confidence:Math.max(...Object.values(s))/Math.max(1,n.split(" ").length)}}async analyzeAudio(e){return{primary:"neutral",scores:{neutral:1},confidence:.5}}}class T{async parse(e,t,n){const s=e.toLowerCase(),i={createTodo:["add todo","பட்டியல் சேர்","create task"],setReminder:["remind","நினைவூட்டு","reminder"],createNote:["note","குறிப்பு","write down"],setEvent:["event","நிகழ்வு","schedule"],startRecording:["record","பதிவு செய்","start recording"],playMusic:["play music","இசை","music"],getWeather:["weather","வானிலை"],checkHealth:["health","உடல் நலம்","how are you"]};for(const[a,o]of Object.entries(i))if(o.some(c=>s.includes(c)))return{type:a,text:e,role:t,language:n,confidence:.8,extracted:this.extractEntities(e,a)};return{type:"unknown",text:e,role:t,language:n,confidence:0}}extractEntities(e,t){const n={};switch(t){case"createTodo":case"setReminder":case"createNote":n.content=e.replace(/^(add todo|பட்டியல் சேர்|remind|நினைவூட்டு|note|குறிப்பு)/i,"").trim();break;case"setEvent":n.title=e.replace(/^(event|நிகழ்வு)/i,"").trim();break}return n}}class C{detect(e){return/[\u0B80-\u0BFF]/.test(e)?"ta":"en"}}class I extends m{constructor(){super("ui",["adapt","personalize","optimize","guide"]),this.currentTheme="default",this.roleThemes=new Map,this.emotionThemes=new Map,this.contextualElements=new Map}async initialize(){await super.initialize(),this.initializeThemes(),this.initializeContextualElements()}initializeThemes(){this.roleThemes.set("paati",{colors:{primary:"emerald",background:"warm",text:"gentle"},layout:{fontSize:"large",spacing:"comfortable",navigation:"simple"},content:{language:"tamil",tone:"respectful",icons:"traditional"},interactions:{pace:"slow",feedback:"verbal",gestures:"minimal"}}),this.roleThemes.set("appa",{colors:{primary:"blue",background:"professional",text:"clear"},layout:{fontSize:"medium",spacing:"efficient",navigation:"structured"},content:{language:"english",tone:"practical",icons:"modern"},interactions:{pace:"fast",feedback:"minimal",gestures:"precise"}}),this.roleThemes.set("amma",{colors:{primary:"purple",background:"warm",text:"nurturing"},layout:{fontSize:"medium",spacing:"organized",navigation:"categorized"},content:{language:"mixed",tone:"caring",icons:"friendly"},interactions:{pace:"balanced",feedback:"encouraging",gestures:"supportive"}}),this.roleThemes.set("kids",{colors:{primary:"orange",background:"playful",text:"fun"},layout:{fontSize:"large",spacing:"spacious",navigation:"visual"},content:{language:"english",tone:"exciting",icons:"animated"},interactions:{pace:"engaging",feedback:"celebratory",gestures:"expressive"}}),this.emotionThemes.set("joy",{colors:{brightness:1.2,saturation:1.1},animations:"celebratory",content:"positive"}),this.emotionThemes.set("stress",{colors:{brightness:.9,saturation:.8},layout:"calming",content:"soothing"}),this.emotionThemes.set("gratitude",{colors:{warmth:1.2},content:"appreciative",interactions:"grateful"})}initializeContextualElements(){this.contextualElements.set("prayer_time",{show:["paati"],elements:["devotional_music","temple_reminder","peaceful_background"]}),this.contextualElements.set("meal_time",{show:["amma","family"],elements:["recipe_suggestions","grocery_reminder","cooking_timer"]}),this.contextualElements.set("study_time",{show:["kids"],elements:["study_timer","break_reminder","achievement_badges"]}),this.contextualElements.set("work_time",{show:["appa"],elements:["focus_timer","task_priorities","meeting_reminder"]})}async execute(e){const{type:t,data:n,role:s,preferences:i,emotion:a}=e;switch(t){case"adapt_interface":return this.adaptInterface(s,a,n==null?void 0:n.context);case"personalize_content":return this.personalizeContent(n==null?void 0:n.content,s,i);case"optimize_layout":return this.optimizeLayout(n==null?void 0:n.screen,s);case"guide_interaction":return this.guideInteraction(n==null?void 0:n.action,s);default:return this.provideUIAdaptation(e)}}adaptInterface(e,t,n){const s=this.roleThemes.get(e)||this.roleThemes.get("family"),i=this.emotionThemes.get(t),a=this.combineThemes(s,i),o=this.getContextualElements(n,e);return{response:`Adapted interface for ${e} with ${t} emotion`,actions:[{type:"apply_theme",data:a},{type:"show_elements",data:o},{type:"update_navigation",data:{role:e,theme:a}}],theme:a,elements:o}}personalizeContent(e,t,n){var a,o;const s=this.roleThemes.get(t),i={...e,language:(n==null?void 0:n.language)||((a=s==null?void 0:s.content)==null?void 0:a.language)||"english",tone:((o=s==null?void 0:s.content)==null?void 0:o.tone)||"neutral",style:this.adaptContentStyle(e,s)};return{response:`Personalized content for ${t}`,actions:[{type:"render_content",data:i}],content:i}}optimizeLayout(e,t){var c,u,y;const n=this.roleThemes.get(t),{width:s,height:i,device:a}=e||{},o={fontSize:this.calculateFontSize(s,(c=n==null?void 0:n.layout)==null?void 0:c.fontSize),spacing:((u=n==null?void 0:n.layout)==null?void 0:u.spacing)||"normal",columns:this.calculateColumns(s,a),navigation:this.optimizeNavigation(s,(y=n==null?void 0:n.layout)==null?void 0:y.navigation)};return{response:`Optimized layout for ${t} on ${a}`,actions:[{type:"apply_layout",data:o}],layout:o}}guideInteraction(e,t){var i,a;const n=this.roleThemes.get(t),s={action:e,role:t,style:((i=n==null?void 0:n.interactions)==null?void 0:i.pace)||"normal",feedback:this.generateFeedback(e,n),gestures:((a=n==null?void 0:n.interactions)==null?void 0:a.gestures)||"standard"};return{response:`Guiding interaction for ${t}`,actions:[{type:"show_guidance",data:s}],guidance:s}}provideUIAdaptation(e){const{role:t,preferences:n,emotion:s}=e,i={theme:this.getAdaptedTheme(t,s),layout:this.getOptimizedLayout(t,n),content:this.getPersonalizedContent(t,n),interactions:this.getInteractionGuide(t)};return{response:`Provided UI adaptation for ${t}`,actions:[{type:"apply_adaptation",data:i}],adaptation:i}}combineThemes(e,t){return t?{...e,colors:{...e.colors,...t.colors},animations:t.animations||e.animations,content:{...e.content,...t.content}}:e}getContextualElements(e,t){const n=[];for(const[s,i]of this.contextualElements)e===s&&i.show.includes(t)&&n.push(...i.elements);return n}adaptContentStyle(e,t){var n,s,i,a,o,c;return{...e.style,tone:((n=t==null?void 0:t.content)==null?void 0:n.tone)||((s=e.style)==null?void 0:s.tone),language:((i=t==null?void 0:t.content)==null?void 0:i.language)||((a=e.style)==null?void 0:a.language),visual:((o=t==null?void 0:t.content)==null?void 0:o.icons)||((c=e.style)==null?void 0:c.visual)}}calculateFontSize(e,t){const n={small:14,medium:16,large:18,xlarge:20};let s=n[t]||n.medium;return e<768?s=Math.max(s-2,12):e>1200&&(s=Math.min(s+2,22)),s}calculateColumns(e,t){return t==="mobile"||e<768?1:e<1024?2:3}optimizeNavigation(e,t){return e<768?"bottom_tabs":t==="simple"?"sidebar_simple":"sidebar_full"}generateFeedback(e,t){var i;const n=((i=t==null?void 0:t.interactions)==null?void 0:i.feedback)||"standard",s={standard:"Action completed successfully",encouraging:"Great job! That was perfect",celebratory:"🎉 Excellent work!",verbal:"I have completed that task for you",minimal:"✓ Done"};return s[n]||s.standard}getAdaptedTheme(e,t){const n=this.roleThemes.get(e),s=this.emotionThemes.get(t);return this.combineThemes(n,s)}getOptimizedLayout(e,t){var s,i,a;const n=this.roleThemes.get(e);return{fontSize:((s=n==null?void 0:n.layout)==null?void 0:s.fontSize)||"medium",spacing:((i=n==null?void 0:n.layout)==null?void 0:i.spacing)||"normal",navigation:((a=n==null?void 0:n.layout)==null?void 0:a.navigation)||"standard"}}getPersonalizedContent(e,t){var s,i,a;const n=this.roleThemes.get(e);return{language:(t==null?void 0:t.language)||((s=n==null?void 0:n.content)==null?void 0:s.language)||"english",tone:((i=n==null?void 0:n.content)==null?void 0:i.tone)||"neutral",style:((a=n==null?void 0:n.content)==null?void 0:a.icons)||"modern"}}getInteractionGuide(e){var n,s,i;const t=this.roleThemes.get(e);return{pace:((n=t==null?void 0:t.interactions)==null?void 0:n.pace)||"normal",feedback:((s=t==null?void 0:t.interactions)==null?void 0:s.feedback)||"standard",gestures:((i=t==null?void 0:t.interactions)==null?void 0:i.gestures)||"standard"}}applyTheme(e){const t=document.documentElement;e.colors&&Object.entries(e.colors).forEach(([n,s])=>{t.style.setProperty(`--theme-${n}`,s)}),document.body.className=`theme-${e.name||"default"}`}showElements(e){document.querySelectorAll("[data-contextual]").forEach(t=>{t.style.display="none"}),e.forEach(t=>{const n=document.querySelector(`[data-contextual="${t}"]`);n&&(n.style.display="block")})}}class D extends m{constructor(){super("tool",["execute","integrate","automate","control"]),this.availableTools=new Map,this.activeIntegrations=new Set,this.toolHistory=[]}async initialize(){await super.initialize(),this.registerTools(),this.initializeIntegrations()}registerTools(){this.availableTools.set("calendar",new E),this.availableTools.set("notes",new F),this.availableTools.set("music",new L),this.availableTools.set("reminders",new j),this.availableTools.set("home_automation",new N),this.availableTools.set("weather",new O),this.availableTools.set("health",new B),this.availableTools.set("shopping",new U),this.availableTools.set("communication",new H)}initializeIntegrations(){this.activeIntegrations.add("local_calendar"),this.activeIntegrations.add("local_notes"),this.activeIntegrations.add("local_music")}async execute(e){const{type:t,data:n,role:s,preferences:i}=e;switch(t){case"execute_action":return this.executeAction(n.action,n.params,s);case"integrate_service":return this.integrateService(n.service,n.config);case"automate_routine":return this.automateRoutine(n.routine,s);case"control_device":return this.controlDevice(n.device,n.command);default:return this.handleToolRequest(e)}}async executeAction(e,t,n){const s=this.findToolForAction(e);if(!s)return{response:`No tool available for action: ${e}`,actions:[]};try{const i=await s.execute(e,t,n);return this.toolHistory.push({timestamp:new Date,action:e,params:t,result:i,role:n}),{response:`Executed ${e} successfully`,actions:[{type:"action_completed",data:{action:e,result:i,role:n}}],result:i}}catch(i){return console.error("Tool execution failed:",i),{response:`Failed to execute ${e}: ${i.message}`,actions:[{type:"action_failed",data:{action:e,error:i,role:n}}]}}}findToolForAction(e){const n={create_event:"calendar",update_event:"calendar",delete_event:"calendar",get_events:"calendar",create_note:"notes",update_note:"notes",delete_note:"notes",search_notes:"notes",play_music:"music",stop_music:"music",generate_music:"music",set_volume:"music",create_reminder:"reminders",update_reminder:"reminders",delete_reminder:"reminders",turn_on_light:"home_automation",turn_off_light:"home_automation",adjust_temperature:"home_automation",lock_door:"home_automation",get_weather:"weather",get_forecast:"weather",log_weight:"health",log_blood_pressure:"health",schedule_checkup:"health",add_to_cart:"shopping",create_list:"shopping",check_price:"shopping",send_message:"communication",make_call:"communication",send_email:"communication"}[e];return n?this.availableTools.get(n):null}async integrateService(e,t){try{const n=await this.initializeServiceIntegration(e,t);return this.activeIntegrations.add(e),{response:`Integrated ${e} successfully`,actions:[{type:"service_integrated",data:{service:e,config:t}}],integration:n}}catch(n){return{response:`Failed to integrate ${e}: ${n.message}`,actions:[]}}}async automateRoutine(e,t){const n={id:`automation_${Date.now()}`,routine:e,role:t,triggers:e.triggers||[],actions:e.actions||[],active:!0};return this.automations=this.automations||new Map,this.automations.set(n.id,n),{response:`Automated routine for ${t}: ${e.name}`,actions:[{type:"routine_automated",data:n}]}}async controlDevice(e,t){const n=this.availableTools.get("home_automation");return n?await n.controlDevice(e,t):{response:"Home automation not available",actions:[]}}handleToolRequest(e){const{intent:t,role:n}=e;return t?this.executeAction(t.type,t.extracted,n):{response:"No intent provided for tool execution",actions:[]}}async initializeServiceIntegration(e,t){switch(e){case"google_calendar":return{status:"connected",api:"google"};case"spotify":return{status:"connected",api:"spotify"};case"alexa":return{status:"connected",api:"alexa"};default:return{status:"connected",api:"local"}}}getToolHistory(e=10){return this.toolHistory.slice(-e)}getAvailableTools(){return Array.from(this.availableTools.keys())}getActiveIntegrations(){return Array.from(this.activeIntegrations)}}class E{async execute(e,t,n){switch(e){case"create_event":return w.update(s=>[...s,{id:Date.now(),title:t.title,date:t.date,time:t.time,category:t.category||"custom",voiceCreated:!0}]),{success:!0,event:t};case"get_events":return{success:!0,events:[]};default:throw new Error(`Unknown calendar action: ${e}`)}}}class F{async execute(e,t,n){switch(e){case"create_note":return A.update(s=>[...s,{id:Date.now(),content:t.content,emotionTag:t.emotion||"neutral",voiceCreated:!0,timestamp:new Date}]),{success:!0,note:t};case"search_notes":return{success:!0,results:[]};default:throw new Error(`Unknown notes action: ${e}`)}}}class L{async execute(e,t,n){switch(e){case"play_music":return{success:!0,track:t.track};case"generate_music":return{success:!0,prompt:t.prompt};case"set_volume":return{success:!0,volume:t.volume};default:throw new Error(`Unknown music action: ${e}`)}}}class j{async execute(e,t,n){switch(e){case"create_reminder":return f.update(s=>[...s,{id:Date.now(),message:t.message,time:t.time,repeat:t.repeat||"none",completed:!1,voiceCreated:!0}]),{success:!0,reminder:t};default:throw new Error(`Unknown reminder action: ${e}`)}}}class N{async execute(e,t,n){switch(e){case"turn_on_light":case"turn_off_light":return{success:!0,device:t.device,state:e.includes("on")?"on":"off"};case"adjust_temperature":return{success:!0,temperature:t.temperature};default:throw new Error(`Unknown home automation action: ${e}`)}}async controlDevice(e,t){return this.execute(t,{device:e},"family")}}class O{async execute(e,t,n){switch(e){case"get_weather":return{success:!0,weather:{temperature:28,condition:"sunny",location:"Coimbatore"}};case"get_forecast":return{success:!0,forecast:[]};default:throw new Error(`Unknown weather action: ${e}`)}}}class B{async execute(e,t,n){switch(e){case"log_weight":return{success:!0,weight:t.weight,date:new Date};case"log_blood_pressure":return{success:!0,systolic:t.systolic,diastolic:t.diastolic};default:throw new Error(`Unknown health action: ${e}`)}}}class U{async execute(e,t,n){switch(e){case"add_to_cart":return{success:!0,item:t.item,quantity:t.quantity};case"create_list":return{success:!0,list:t.items};default:throw new Error(`Unknown shopping action: ${e}`)}}}class H{async execute(e,t,n){switch(e){case"send_message":return{success:!0,recipient:t.recipient,message:t.message};case"make_call":return{success:!0,number:t.number};case"send_email":return{success:!0,to:t.to,subject:t.subject};default:throw new Error(`Unknown communication action: ${e}`)}}}class W extends m{constructor(){super("music",["generate","play","compose","analyze"]),this.currentTrack=null,this.isPlaying=!1,this.volume=.8,this.musicHistory=[],this.emotionalThemes=new Map}async initialize(){await super.initialize(),this.initializeEmotionalThemes(),this.initializeAudioContext()}initializeEmotionalThemes(){this.emotionalThemes.set("joy",{genres:["upbeat","folk","electronic"],tempo:"fast",instruments:["flute","percussion","strings"],mood:"celebratory"}),this.emotionalThemes.set("stress",{genres:["ambient","meditative","classical"],tempo:"slow",instruments:["piano","harp","nature_sounds"],mood:"calming"}),this.emotionalThemes.set("gratitude",{genres:["devotional","spiritual","acoustic"],tempo:"moderate",instruments:["veena","sitar","vocal"],mood:"peaceful"}),this.emotionalThemes.set("neutral",{genres:["ambient","folk","instrumental"],tempo:"moderate",instruments:["flute","guitar","percussion"],mood:"balanced"})}initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.warn("Web Audio API not supported:",e)}}async execute(e){const{type:t,data:n,role:s,preferences:i,emotion:a}=e;switch(t){case"generate_music":return this.generateMusic(n.prompt,a,s);case"play_music":return this.playMusic(n.track);case"stop_music":return this.stopMusic();case"compose_from_humming":return this.composeFromHumming(n.audio,s);case"adjust_mood":return this.adjustMoodMusic(a);case"create_playlist":return this.createPlaylist(n.theme,s);default:return this.handleMusicRequest(e)}}async generateMusic(e,t,n){try{const s=this.enhancePrompt(e,t,n),i=await this.generateMusicFromPrompt(s),a={id:`track_${Date.now()}`,prompt:s,emotion:t,role:n,buffer:i,duration:i.duration,created:new Date};return this.musicHistory.push(a),{response:`Generated music for ${n} with ${t} emotion`,actions:[{type:"music_generated",data:a},{type:"auto_play",data:{track:a}}],track:a}}catch(s){return{response:`Failed to generate music: ${s.message}`,actions:[]}}}async playMusic(e){if(!e||!e.buffer)return{response:"No track to play",actions:[]};try{return await this.playAudioBuffer(e.buffer),this.currentTrack=e,this.isPlaying=!0,{response:`Playing music: ${e.prompt}`,actions:[{type:"music_playing",data:{track:e,volume:this.volume}}]}}catch(t){return{response:`Failed to play music: ${t.message}`,actions:[]}}}async stopMusic(){return this.currentTrack&&this.isPlaying?(this.stopAudioPlayback(),this.isPlaying=!1,{response:"Music stopped",actions:[{type:"music_stopped",data:{track:this.currentTrack}}]}):{response:"No music playing",actions:[]}}async composeFromHumming(e,t){try{const n=await this.analyzeMelody(e),s=this.createPromptFromMelody(n,t);return await this.generateMusic(s,"joy",t)}catch(n){return{response:`Failed to compose from humming: ${n.message}`,actions:[]}}}async adjustMoodMusic(e){const t=this.emotionalThemes.get(e)||this.emotionalThemes.get("neutral"),n=this.createMoodPrompt(t);return await this.generateMusic(n,e,"family")}async createPlaylist(e,t){const n=[];for(let i=0;i<3;i++){const a=`${e} music variation ${i+1} for ${t}`,o=await this.generateMusic(a,"neutral",t);o.track&&n.push(o.track)}const s={id:`playlist_${Date.now()}`,theme:e,role:t,tracks:n,created:new Date};return{response:`Created playlist with ${n.length} tracks`,actions:[{type:"playlist_created",data:s}],playlist:s}}handleMusicRequest(e){const{text:t,role:n,emotion:s}=e;if(t.includes("play")||t.includes("music")){const i=this.extractMusicPrompt(t);return this.generateMusic(i,s,n)}return t.includes("stop")||t.includes("quiet")?this.stopMusic():t.includes("mood")||t.includes("feeling")?this.adjustMoodMusic(s):{response:"Music request not recognized",actions:[]}}enhancePrompt(e,t,n){const s=this.emotionalThemes.get(t),i=this.getRoleMusicPreferences(n);let a=e;return s&&(a+=`, ${s.mood} mood, ${s.tempo} tempo`,s.instruments.length>0&&(a+=`, featuring ${s.instruments.slice(0,2).join(" and ")}`)),i&&(a+=`, ${i.style}`),a}async generateMusicFromPrompt(e){try{const{generateMusic:t,buildMusicPrompt:n}=await z(async()=>{const{generateMusic:s,buildMusicPrompt:i}=await import("./BKKHa0w5.js");return{generateMusic:s,buildMusicPrompt:i}},[],import.meta.url);return await t(n(e))}catch{return console.warn("Music generation not available, using fallback"),this.createFallbackAudioBuffer()}}async playAudioBuffer(e){if(!this.audioContext)return;const t=this.audioContext.createBufferSource();t.buffer=e,t.connect(this.audioContext.destination),t.start(),this.currentSource=t}stopAudioPlayback(){this.currentSource&&(this.currentSource.stop(),this.currentSource=null)}async analyzeMelody(e){return{key:"C",tempo:120,duration:5,notes:["C4","D4","E4","C4"]}}createPromptFromMelody(e,t){const{key:n,tempo:s,notes:i}=e,a=this.getRoleMusicPreferences(t);return`Music in ${n} key, ${s} BPM, based on melody ${i.join(" ")}, ${(a==null?void 0:a.style)||"instrumental"}`}createMoodPrompt(e){return`${e.genres[0]} ${e.mood} music with ${e.instruments[0]}, ${e.tempo} tempo`}extractMusicPrompt(e){const t=["play","music","song","melody","tune"],n=["classical","folk","devotional","ambient","electronic"];let s=e;return t.forEach(i=>{s=s.replace(new RegExp(i,"gi"),"")}),s=s.trim(),s.length<3&&(s=n.find(a=>e.includes(a))||"ambient instrumental"),s}getRoleMusicPreferences(e){const t={paati:{style:"devotional with traditional instruments like veena and flute"},appa:{style:"instrumental with focus on melody and rhythm"},amma:{style:"soothing and peaceful with gentle instrumentation"},kids:{style:"upbeat and playful with fun melodies"},family:{style:"warm and harmonious with family-friendly instrumentation"}};return t[e]||t.family}createFallbackAudioBuffer(){if(!this.audioContext)return null;const e=3,t=this.audioContext.sampleRate,n=e*t,s=this.audioContext.createBuffer(1,n,t),i=s.getChannelData(0);for(let a=0;a<n;a++)i[a]=Math.sin(2*Math.PI*440*a/t)*.1;return s}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.currentSource&&this.currentSource.gainNode&&(this.currentSource.gainNode.gain.value=this.volume)}getMusicHistory(e=10){return this.musicHistory.slice(-e)}getCurrentTrack(){return this.currentTrack}isMusicPlaying(){return this.isPlaying}}const _=new M,h=new P,g=new $,v=new I,k=new D,V=new W;l.registerAgent(_);l.registerAgent(h);l.registerAgent(g);l.registerAgent(v);l.registerAgent(k);l.registerAgent(V);class q{constructor(){this.isInitialized=!1,this.currentRole="family",this.systemStatus="asleep"}async initialize(){if(!this.isInitialized)try{console.log("Initializing Shivo Agentic AI System..."),await l.initializeAllAgents(),this.setupRoleDetection(),this.setupAutonomousRoutines(),this.isInitialized=!0,this.systemStatus="active",console.log("Shivo AI System initialized successfully"),p.update(e=>({...e,activeAgents:l.agents.keys(),activeRole:this.currentRole}))}catch(e){console.error("Failed to initialize Shivo AI System:",e),this.systemStatus="error"}}async shutdown(){await l.shutdownAllAgents(),this.systemStatus="shutdown"}async processInteraction(e){this.isInitialized||await this.initialize();try{const t=this.detectRole(e);t!==this.currentRole&&await this.switchRole(t);const n=l.getRolePreferences(),s={...e,role:this.currentRole,preferences:n,context:await this.getContext()},i=await l.processWithAgents(s);return this.updateSystemState(i),i}catch(t){return console.error("Error processing interaction:",t),{responses:["I apologize, but I encountered an error processing your request."],actions:[],error:t.message}}}async startVoiceListening(){return await g.process({type:"start_listening",role:this.currentRole})}async stopVoiceListening(){return await g.process({type:"stop_listening"})}async processVoiceCommand(e){return await this.processInteraction({type:"voice_command",text:e,source:"voice"})}async switchRole(e){if(!l.roles[e])throw new Error(`Unknown role: ${e}`);this.currentRole=e,l.setActiveRole(e),await v.process({type:"adapt_interface",role:e,context:"role_switch"}),p.update(t=>({...t,activeRole:e})),console.log(`Switched to role: ${e}`)}detectRole(e){const{text:t,context:n}=e;if(!t)return this.currentRole;const s=t.toLowerCase(),i={paati:["paati","grandma","grandmother","அம்மா","பாட்டி"],appa:["appa","dad","father","அப்பா"],amma:["amma","mom","mother","அம்மா"],kids:["kids","children","பிள்ளைகள்","குழந்தைகள்"]};for(const[a,o]of Object.entries(i))if(o.some(c=>s.includes(c)))return a;return this.detectRoleByTime()}detectRoleByTime(){const e=new Date().getHours();return e>=5&&e<9?"paati":e>=9&&e<17?"appa":e>=17&&e<21?"amma":e>=21||e<5?"kids":"family"}async getContext(){var t,n;const e=await _.process({type:"recall_context",role:this.currentRole});return{role:this.currentRole,time:new Date,recentActivities:((t=e.context)==null?void 0:t.recentFacts)||[],emotionalState:((n=e.context)==null?void 0:n.emotionalState)||"neutral",preferences:l.getRolePreferences()}}setupAutonomousRoutines(){setInterval(async()=>{try{const e=await h.process({type:"check_routines",role:this.currentRole});if(e.actions.length>0)for(const t of e.actions)await this.executeAutonomousAction(t)}catch(e){console.warn("Autonomous routine check failed:",e)}},6e4)}async executeAutonomousAction(e){try{switch(e.type){case"remind_prayer":await this.processInteraction({type:"autonomous",text:"Time for morning prayers",context:"routine"});break;case"plan_temple":await this.processInteraction({type:"autonomous",text:"Plan temple visit for today",context:"routine"});break;case"remind_walk":await this.processInteraction({type:"autonomous",text:"Time for morning walk",context:"routine"});break;default:console.log("Unknown autonomous action:",e.type)}}catch(t){console.warn("Autonomous action execution failed:",t)}}updateSystemState(e){p.update(t=>{var n;return{...t,lastInteraction:{timestamp:new Date,role:this.currentRole,result:e},memory:((n=e.context)==null?void 0:n.recentFacts)||t.memory}})}async pursueGoal(e){const t=await h.process({type:"create_plan",data:e,role:this.currentRole});if(t.actions)for(const n of t.actions)await k.process({type:"execute_action",data:{action:n.type,params:n.data},role:this.currentRole});return t}getStatus(){return{initialized:this.isInitialized,status:this.systemStatus,currentRole:this.currentRole,activeAgents:Array.from(l.agents.keys()),rolePreferences:l.getRolePreferences()}}async handleEmergency(e){await this.switchRole("family");const t={type:"emergency",situation:e,priority:"high"};return await this.processInteraction({type:"emergency",text:`Emergency: ${e}`,context:t})}}const d=new q;async function G(){await d.initialize()}async function X(r){return await d.processInteraction(r)}async function Y(r){await d.switchRole(r)}function Z(){return d.getStatus()}typeof window<"u"&&document.addEventListener("DOMContentLoaded",async()=>{try{await G(),console.log("Shivo AI auto-initialized")}catch(r){console.warn("Shivo AI auto-initialization failed:",r)}});export{Y as a,p as b,Z as g,X as p,d as s};
