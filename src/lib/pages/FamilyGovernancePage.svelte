<script>
  import { onMount } from "svelte";
  import Icon from "@iconify/svelte";
  import { db } from "../data/database.js";

  let currentTab = "constitution";
  let familyRules = [];
  let familyDecisions = [];
  let showAddRule = false;
  let showAddDecision = false;

  const tabs = [
    { id: "constitution", label: "Family Constitution", icon: "heroicons:document-text" },
    { id: "rules", label: "Family Rules", icon: "heroicons:clipboard-document-list" },
    { id: "decisions", label: "Decision Making", icon: "heroicons:check-circle" },
    { id: "meetings", label: "Family Meetings", icon: "heroicons:user-group" },
    { id: "values", label: "Core Values", icon: "heroicons:heart" },
  ];

  let newRule = {
    title: "",
    description: "",
    category: "household",
    importance: "medium",
    consequences: "",
    exceptions: [],
    approvedBy: [],
    effective_date: "",
  };

  let newDecision = {
    title: "",
    description: "",
    type: "consensus",
    status: "proposed",
    votes: {},
    deadline: "",
    impact: "low",
    stakeholders: [],
  };

  const ruleCategories = [
    { id: "household", label: "Household Management", icon: "heroicons:home", color: "text-blue-500" },
    { id: "financial", label: "Financial Guidelines", icon: "heroicons:banknotes", color: "text-green-500" },
    { id: "education", label: "Education & Learning", icon: "heroicons:academic-cap", color: "text-purple-500" },
    { id: "technology", label: "Technology Use", icon: "heroicons:device-phone-mobile", color: "text-orange-500" },
    { id: "social", label: "Social Interactions", icon: "heroicons:users", color: "text-pink-500" },
    { id: "health", label: "Health & Wellness", icon: "heroicons:heart", color: "text-red-500" },
    { id: "cultural", label: "Cultural Practices", icon: "heroicons:sparkles", color: "text-yellow-500" },
    { id: "emergency", label: "Emergency Protocols", icon: "heroicons:exclamation-triangle", color: "text-red-600" },
  ];

  let familyConstitution = {
    preamble: `We, the members of the Iyer family, in order to form a more harmonious household, establish justice in our daily interactions, ensure domestic tranquility, provide for the common welfare, and secure the blessings of unity for ourselves and our posterity, do establish this Family Constitution.

Based on the principles of:
• सर्वे भवन्तु सुखिनः (May all be happy)
• वसुधैव कुटुम्बकम् (The world is one family)
• अहिंसा परमो धर्मः (Non-violence is the highest virtue)`,

    articles: [
      {
        title: "Article I: Family Membership and Rights",
        content: `All family members, by birth or marriage, are equal in dignity and respect. Each member has the right to:
        • Express opinions and feelings respectfully
        • Receive support during difficulties
        • Pursue personal growth and education
        • Maintain cultural and spiritual practices
        • Privacy and personal space
        • Participate in family decisions affecting them`,
      },
      {
        title: "Article II: Responsibilities and Duties",
        content: `Each family member shall:
        • Contribute to household harmony and maintenance
        • Respect elders and guide younger members
        • Share in family traditions and celebrations
        • Support family financial well-being according to capability
        • Maintain family honor and reputation
        • Preserve and pass on cultural heritage`,
      },
      {
        title: "Article III: Decision Making Process",
        content: `Family decisions shall be made through:
        • Consensus for major decisions affecting all members
        • Elder guidance for cultural and traditional matters
        • Democratic voting for household management
        • Delegation to appropriate family members for daily operations
        • Emergency protocols for urgent situations`,
      },
      {
        title: "Article IV: Conflict Resolution",
        content: `Disputes shall be resolved through:
        • Open family discussion with respectful listening
        • Mediation by neutral family members
        • Elder council guidance when needed
        • External counseling if internal resolution fails
        • Temporary cooling-off periods when emotions are high`,
      },
      {
        title: "Article V: Amendments",
        content: `This constitution may be amended with:
        • Agreement of 75% of adult family members
        • Approval from family elders
        • Written documentation of changes
        • Grace period for implementation
        • Regular review every three years`,
      },
    ],
  };

  let coreValues = [
    {
      value: "सत्यम् (Satyam) - Truth",
      sanskrit: "सत्यं ब्रूयात् प्रियं ब्रूयात्",
      meaning: "Speak truth, speak pleasantly",
      application: "Always be honest while being kind and considerate",
      examples: ["Admitting mistakes without fear of punishment", "Sharing feelings and concerns openly", "Being transparent about family finances"],
    },
    {
      value: "दया (Daya) - Compassion",
      sanskrit: "दया धर्मस्य मूलम्",
      meaning: "Compassion is the root of righteousness",
      application: "Show kindness and understanding to all family members",
      examples: ["Supporting each other during difficult times", "Forgiving mistakes and learning from them", "Helping extended family and community"],
    },
    {
      value: "सेवा (Seva) - Service",
      sanskrit: "परोपकाराय फलन्ति वृक्षाः",
      meaning: "Trees bear fruit for the benefit of others",
      application: "Contribute to family welfare without expecting rewards",
      examples: ["Helping with household chores willingly", "Supporting each other's goals and dreams", "Caring for elderly family members"],
    },
    {
      value: "अनुशासन (Anushashan) - Discipline",
      sanskrit: "अनुशासनं परमं बलम्",
      meaning: "Discipline is the greatest strength",
      application: "Maintain self-control and follow family guidelines",
      examples: ["Keeping regular schedules and routines", "Managing technology use responsibly", "Maintaining health and wellness practices"],
    },
  ];

  let meetingSchedule = [
    {
      type: "Weekly Family Check-in",
      frequency: "Every Sunday evening",
      duration: "30-45 minutes",
      purpose: "Share weekly experiences and plan ahead",
      facilitator: "Rotating among family members",
      agenda: ["Gratitude sharing", "Weekly highlights and challenges", "Upcoming week planning", "Quick issue resolution"],
    },
    {
      type: "Monthly Family Council",
      frequency: "First Saturday of each month",
      duration: "1-2 hours",
      purpose: "Discuss major family matters and decisions",
      facilitator: "Family head or designated elder",
      agenda: ["Financial review and planning", "Major household decisions", "Children's progress and needs", "Extended family matters"],
    },
    {
      type: "Quarterly Strategic Planning",
      frequency: "Every three months",
      duration: "2-3 hours",
      purpose: "Long-term family planning and goal setting",
      facilitator: "All adult members",
      agenda: ["Family goals review", "Education and career planning", "Major purchases and investments", "Cultural and spiritual activities"],
    },
  ];

  let decisionTypes = [
    { id: "consensus", label: "Consensus", description: "All members must agree" },
    { id: "majority", label: "Majority Vote", description: "More than 50% agreement" },
    { id: "elder", label: "Elder Decision", description: "Senior family members decide" },
    { id: "delegate", label: "Delegated", description: "Assigned to specific member" },
    { id: "emergency", label: "Emergency", description: "Immediate action required" },
  ];

  async function loadFamilyRules() {
    try {
      familyRules = (await db.familyRules?.toArray()) || [];
    } catch (error) {
      console.error("Error loading family rules:", error);
      familyRules = [];
    }
  }

  async function loadFamilyDecisions() {
    try {
      familyDecisions = (await db.familyDecisions?.toArray()) || [];
    } catch (error) {
      console.error("Error loading family decisions:", error);
      familyDecisions = [];
    }
  }

  async function addFamilyRule() {
    if (!newRule.title.trim() || !newRule.description.trim()) return;

    try {
      const rule = {
        ...newRule,
        id: Date.now(),
        createdAt: new Date().toISOString(),
        status: "active",
      };

      await db.familyRules?.add(rule);
      familyRules = [...familyRules, rule];

      // Reset form
      newRule = {
        title: "",
        description: "",
        category: "household",
        importance: "medium",
        consequences: "",
        exceptions: [],
        approvedBy: [],
        effective_date: "",
      };
      showAddRule = false;
    } catch (error) {
      console.error("Error adding family rule:", error);
    }
  }

  async function addFamilyDecision() {
    if (!newDecision.title.trim() || !newDecision.description.trim()) return;

    try {
      const decision = {
        ...newDecision,
        id: Date.now(),
        createdAt: new Date().toISOString(),
        proposedBy: "Current User", // In real app, this would be the logged-in user
      };

      await db.familyDecisions?.add(decision);
      familyDecisions = [...familyDecisions, decision];

      // Reset form
      newDecision = {
        title: "",
        description: "",
        type: "consensus",
        status: "proposed",
        votes: {},
        deadline: "",
        impact: "low",
        stakeholders: [],
      };
      showAddDecision = false;
    } catch (error) {
      console.error("Error adding family decision:", error);
    }
  }

  function getCategoryIcon(categoryId) {
    return ruleCategories.find((cat) => cat.id === categoryId)?.icon || "heroicons:clipboard-document-list";
  }

  function getCategoryColor(categoryId) {
    return ruleCategories.find((cat) => cat.id === categoryId)?.color || "text-gray-500";
  }

  function getImportanceColor(importance) {
    switch (importance) {
      case "high":
        return "text-red-500 bg-red-100 dark:bg-red-900/20";
      case "medium":
        return "text-yellow-500 bg-yellow-100 dark:bg-yellow-900/20";
      case "low":
        return "text-green-500 bg-green-100 dark:bg-green-900/20";
      default:
        return "text-gray-500 bg-gray-100 dark:bg-gray-900/20";
    }
  }

  function getStatusColor(status) {
    switch (status) {
      case "proposed":
        return "text-blue-500 bg-blue-100 dark:bg-blue-900/20";
      case "voting":
        return "text-orange-500 bg-orange-100 dark:bg-orange-900/20";
      case "approved":
        return "text-green-500 bg-green-100 dark:bg-green-900/20";
      case "rejected":
        return "text-red-500 bg-red-100 dark:bg-red-900/20";
      case "implemented":
        return "text-purple-500 bg-purple-100 dark:bg-purple-900/20";
      default:
        return "text-gray-500 bg-gray-100 dark:bg-gray-900/20";
    }
  }

  onMount(() => {
    document.title = "Family Governance - Family App";
    loadFamilyRules();
    loadFamilyDecisions();
  });
</script>

<div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900/20 dark:to-indigo-900/20">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-3">
          <div class="p-3 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-xl text-white">
            <Icon icon="heroicons:document-text" class="w-8 h-8" />
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Family Governance</h1>
            <p class="text-gray-600 dark:text-gray-300">राज्यं धर्मेण धर्यते | A kingdom is sustained by righteousness</p>
          </div>
        </div>
      </div>

      <!-- Governance Wisdom -->
      <div class="bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl p-6 text-white mb-6">
        <div class="flex items-center space-x-4">
          <Icon icon="heroicons:scale" class="w-12 h-12 text-white/80" />
          <div>
            <h3 class="text-xl font-bold mb-2">पारिवारिक शासन | Family Governance</h3>
            <p class="text-white/90">"A well-governed family is the foundation of a harmonious society. Through clear principles and shared decision-making, we create lasting peace."</p>
            <p class="text-sm text-white/70 mt-2">Tamil: "நல்ல குடும்ப நிர்வாகம் அமைதியான சமுதாயத்தின் அடித்தளம்"</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex flex-wrap gap-2 mb-6">
      {#each tabs as tab}
        <button class="flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200 {currentTab === tab.id ? 'bg-blue-500 text-white shadow-lg' : 'bg-white/80 text-gray-700 hover:bg-blue-100 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-blue-900/20'}" on:click={() => (currentTab = tab.id)}>
          <Icon icon={tab.icon} class="w-4 h-4" />
          <span class="font-medium">{tab.label}</span>
        </button>
      {/each}
    </div>

    <!-- Content -->
    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-xl p-6">
      {#if currentTab === "constitution"}
        <div>
          <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-6">📜 Family Constitution</h3>

          <!-- Preamble -->
          <div class="mb-8 p-6 bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 rounded-xl border border-amber-200 dark:border-amber-700">
            <h4 class="text-lg font-bold text-amber-900 dark:text-amber-100 mb-4">प्रस्तावना | Preamble</h4>
            <div class="prose dark:prose-invert max-w-none">
              <p class="text-amber-800 dark:text-amber-200 whitespace-pre-line">{familyConstitution.preamble}</p>
            </div>
          </div>

          <!-- Articles -->
          <div class="space-y-6">
            {#each familyConstitution.articles as article}
              <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border border-blue-200 dark:border-blue-700">
                <h4 class="text-lg font-bold text-blue-900 dark:text-blue-100 mb-4">{article.title}</h4>
                <div class="prose dark:prose-invert max-w-none">
                  <p class="text-blue-800 dark:text-blue-200 whitespace-pre-line">{article.content}</p>
                </div>
              </div>
            {/each}
          </div>

          <!-- Constitutional Wisdom -->
          <div class="mt-8 p-6 bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 rounded-xl">
            <h4 class="font-bold text-purple-800 dark:text-purple-200 mb-4 flex items-center">
              <Icon icon="heroicons:scale" class="w-5 h-5 mr-2" />
              संविधान का आधार | Constitutional Foundation
            </h4>
            <blockquote class="italic text-purple-700 dark:text-purple-300 mb-2">
              "धर्मे च अर्थे च कामे च मोक्षे च भरतर्षभ।<br />
              यदिहास्ति तदन्यत्र यन्नेहास्ति न तत्क्वचित्॥"
            </blockquote>
            <p class="text-sm text-purple-600 dark:text-purple-400">"What is found here regarding dharma, artha, kama, and moksha may be found elsewhere, but what is not found here cannot be found anywhere else."</p>
            <p class="text-xs text-purple-500 dark:text-purple-500 mt-2">Tamil: "இங்கே காணப்படும் நீதி, செல்வம், காமம், மோக்ஷம் ஆகியவை எங்கும் காணலாம், ஆனால் இங்கே இல்லாதது எங்கும் இல்லை"</p>
          </div>
        </div>
      {:else if currentTab === "rules"}
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300">📋 Family Rules & Guidelines</h3>
          <button class="flex items-center space-x-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors" on:click={() => (showAddRule = true)}>
            <Icon icon="heroicons:plus" class="w-4 h-4" />
            <span>Add Rule</span>
          </button>
        </div>

        {#if showAddRule}
          <div class="mb-6 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl">
            <h4 class="font-semibold text-blue-800 dark:text-blue-200 mb-4">Create New Family Rule</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Rule Title</label>
                <input type="text" bind:value={newRule.title} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="What is this rule about?" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category</label>
                <select bind:value={newRule.category} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  {#each ruleCategories as category}
                    <option value={category.id}>{category.label}</option>
                  {/each}
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Importance</label>
                <select bind:value={newRule.importance} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Effective Date</label>
                <input type="date" bind:value={newRule.effective_date} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Rule Description</label>
                <textarea bind:value={newRule.description} rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Describe the rule in detail..."></textarea>
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Consequences (if any)</label>
                <textarea bind:value={newRule.consequences} rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="What happens if this rule is not followed?"></textarea>
              </div>
            </div>
            <div class="flex space-x-3 mt-4">
              <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors" on:click={addFamilyRule}> Save Rule </button>
              <button class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors" on:click={() => (showAddRule = false)}> Cancel </button>
            </div>
          </div>
        {/if}

        <!-- Rules List -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {#each familyRules as rule}
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow">
              <div class="flex items-start justify-between mb-4">
                <div class="flex items-center space-x-3">
                  <Icon icon={getCategoryIcon(rule.category)} class="w-6 h-6 {getCategoryColor(rule.category)}" />
                  <div>
                    <h4 class="font-bold text-gray-900 dark:text-white">{rule.title}</h4>
                    <p class="text-sm text-blue-600 dark:text-blue-400">
                      {ruleCategories.find((cat) => cat.id === rule.category)?.label}
                    </p>
                  </div>
                </div>
                <span class="px-2 py-1 text-xs font-medium rounded-full {getImportanceColor(rule.importance)}">
                  {rule.importance.toUpperCase()}
                </span>
              </div>

              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">{rule.description}</p>

              {#if rule.consequences}
                <div class="mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                  <h5 class="font-semibold text-yellow-800 dark:text-yellow-200 text-sm mb-1">Consequences:</h5>
                  <p class="text-xs text-yellow-700 dark:text-yellow-300">{rule.consequences}</p>
                </div>
              {/if}

              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-500 dark:text-gray-400">
                  {rule.effective_date ? `Effective: ${new Date(rule.effective_date).toLocaleDateString()}` : "Effective immediately"}
                </span>
                <span class="px-2 py-1 text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 rounded-full"> Active </span>
              </div>
            </div>
          {/each}
        </div>

        {#if familyRules.length === 0}
          <div class="text-center py-12">
            <Icon icon="heroicons:clipboard-document-list" class="w-16 h-16 mx-auto text-blue-400 mb-4" />
            <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">No Family Rules Yet</h3>
            <p class="text-gray-500 dark:text-gray-400 mb-4">Start building your family's governance structure</p>
            <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors" on:click={() => (showAddRule = true)}> Create First Rule </button>
          </div>
        {/if}
      {:else if currentTab === "decisions"}
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300">✅ Family Decision Making</h3>
          <button class="flex items-center space-x-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors" on:click={() => (showAddDecision = true)}>
            <Icon icon="heroicons:plus" class="w-4 h-4" />
            <span>Propose Decision</span>
          </button>
        </div>

        {#if showAddDecision}
          <div class="mb-6 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl">
            <h4 class="font-semibold text-blue-800 dark:text-blue-200 mb-4">Propose Family Decision</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Decision Title</label>
                <input type="text" bind:value={newDecision.title} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="What needs to be decided?" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Decision Type</label>
                <select bind:value={newDecision.type} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  {#each decisionTypes as type}
                    <option value={type.id}>{type.label} - {type.description}</option>
                  {/each}
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Impact Level</label>
                <select bind:value={newDecision.impact} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  <option value="low">Low Impact</option>
                  <option value="medium">Medium Impact</option>
                  <option value="high">High Impact</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Decision Deadline</label>
                <input type="date" bind:value={newDecision.deadline} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Decision Description</label>
                <textarea bind:value={newDecision.description} rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Describe the decision that needs to be made, including options and implications..."></textarea>
              </div>
            </div>
            <div class="flex space-x-3 mt-4">
              <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors" on:click={addFamilyDecision}> Propose Decision </button>
              <button class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors" on:click={() => (showAddDecision = false)}> Cancel </button>
            </div>
          </div>
        {/if}

        <!-- Decisions List -->
        <div class="space-y-4">
          {#each familyDecisions as decision}
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <h4 class="font-bold text-gray-900 dark:text-white text-lg">{decision.title}</h4>
                  <p class="text-sm text-blue-600 dark:text-blue-400">
                    Proposed by {decision.proposedBy} • {decisionTypes.find((t) => t.id === decision.type)?.label}
                  </p>
                </div>
                <div class="flex space-x-2">
                  <span class="px-2 py-1 text-xs font-medium rounded-full {getStatusColor(decision.status)}">
                    {decision.status.toUpperCase()}
                  </span>
                  <span class="px-2 py-1 text-xs font-medium rounded-full {decision.impact === 'high' ? 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300' : decision.impact === 'medium' ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300' : 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300'}">
                    {decision.impact.toUpperCase()} IMPACT
                  </span>
                </div>
              </div>

              <p class="text-gray-600 dark:text-gray-400 mb-4">{decision.description}</p>

              <div class="flex items-center justify-between">
                <div class="flex space-x-4">
                  {#if decision.status === "proposed" || decision.status === "voting"}
                    <button class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors"> 👍 Support </button>
                    <button class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors"> 👎 Oppose </button>
                    <button class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 transition-colors"> 🤔 Discuss </button>
                  {/if}
                </div>
                <div class="text-right">
                  {#if decision.deadline}
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                      Deadline: {new Date(decision.deadline).toLocaleDateString()}
                    </p>
                  {/if}
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Created: {new Date(decision.createdAt).toLocaleDateString()}
                  </p>
                </div>
              </div>
            </div>
          {/each}
        </div>

        {#if familyDecisions.length === 0}
          <div class="text-center py-12">
            <Icon icon="heroicons:check-circle" class="w-16 h-16 mx-auto text-blue-400 mb-4" />
            <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">No Pending Decisions</h3>
            <p class="text-gray-500 dark:text-gray-400 mb-4">Start the democratic process by proposing a family decision</p>
            <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors" on:click={() => (showAddDecision = true)}> Propose First Decision </button>
          </div>
        {/if}
      {:else if currentTab === "meetings"}
        <div>
          <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-6">👥 Family Meeting Structure</h3>
          <div class="space-y-6">
            {#each meetingSchedule as meeting}
              <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border border-green-200 dark:border-green-700">
                <div class="flex items-start justify-between mb-4">
                  <div>
                    <h4 class="text-xl font-bold text-green-900 dark:text-green-100">{meeting.type}</h4>
                    <p class="text-green-700 dark:text-green-300">{meeting.frequency} • {meeting.duration}</p>
                    <p class="text-green-600 dark:text-green-400 text-sm">Facilitated by: {meeting.facilitator}</p>
                  </div>
                  <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors"> Schedule Next </button>
                </div>

                <p class="text-green-800 dark:text-green-200 mb-4">{meeting.purpose}</p>

                <div>
                  <h5 class="font-semibold text-green-900 dark:text-green-100 mb-2">Typical Agenda:</h5>
                  <div class="space-y-1">
                    {#each meeting.agenda as item, index}
                      <div class="flex items-center space-x-2">
                        <span class="text-xs bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 rounded-full w-5 h-5 flex items-center justify-center font-bold">
                          {index + 1}
                        </span>
                        <span class="text-sm text-green-700 dark:text-green-300">{item}</span>
                      </div>
                    {/each}
                  </div>
                </div>
              </div>
            {/each}
          </div>
        </div>
      {:else if currentTab === "values"}
        <div>
          <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-6">❤️ Core Family Values</h3>
          <div class="space-y-8">
            {#each coreValues as value}
              <div class="bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-xl p-6 border border-orange-200 dark:border-orange-700">
                <div class="mb-4">
                  <h4 class="text-xl font-bold text-orange-900 dark:text-orange-100">{value.value}</h4>
                  <p class="text-orange-700 dark:text-orange-300 italic mb-2">"{value.sanskrit}"</p>
                  <p class="text-orange-600 dark:text-orange-400 text-sm">{value.meaning}</p>
                </div>

                <p class="text-orange-800 dark:text-orange-200 mb-4">{value.application}</p>

                <div>
                  <h5 class="font-semibold text-orange-900 dark:text-orange-100 mb-2">How We Practice This:</h5>
                  <div class="space-y-2">
                    {#each value.examples as example}
                      <div class="flex items-start space-x-2">
                        <Icon icon="heroicons:star" class="w-4 h-4 text-yellow-500 mt-0.5" />
                        <span class="text-sm text-orange-700 dark:text-orange-300">{example}</span>
                      </div>
                    {/each}
                  </div>
                </div>
              </div>
            {/each}
          </div>

          <!-- Dharmic Foundation -->
          <div class="mt-8 p-6 bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 rounded-xl">
            <h4 class="font-bold text-purple-800 dark:text-purple-200 mb-4 flex items-center">
              <Icon icon="heroicons:heart" class="w-5 h-5 mr-2" />
              धर्मिक आधार | Dharmic Foundation
            </h4>
            <p class="text-purple-700 dark:text-purple-300 mb-2">
              "चत्वारि तेषां पादानि सत्यं शौचं दया तपः।<br />
              कलौ काष्ठैकशेषाणि तान्याहुः सत्त्वमत्युतम्॥"
            </p>
            <p class="text-sm text-purple-600 dark:text-purple-400">"The four pillars of dharma are truth, cleanliness, compassion, and austerity. In Kali Yuga, only one-fourth remains, and they say that is supreme virtue."</p>
            <p class="text-xs text-purple-500 dark:text-purple-500 mt-2">Tamil: "தர்மத்தின் நான்கு கால்கள்: சத்யம், தூய்மை, தயை, தவம்"</p>
          </div>
        </div>
      {/if}
    </div>
  </div>
</div>
